# üìä ANALYSE DU PROJET ACTUEL - MIGRATION NEXT.JS

**Date:** 8 Octobre 2025
**Branche:** refactor-test
**Objectif:** Refactoriser en Next.js 14 avec architecture propre

---

## üóÇÔ∏è INVENTAIRE DES FICHIERS

### Pages HTML (28 fichiers)

**Pages Publiques:**
- `index.html` - Page d'accueil
- `acteurs-locaux.html` - Annuaire professionnels/commerces
- `evenements.html` - Calendrier √©v√©nements
- `echangeons.html` - Petites annonces
- `parlons-en.html` - Forum discussion
- `carte.html` - Carte interactive Google Maps
- `covoiturage.html` - Covoiturage local
- `troc-tout.html` - Troc et services
- `boite-idees.html` - Bo√Æte √† id√©es
- `itineraires-rando.html` - Randonn√©es
- `panneau-village.html` - Panneau village
- `activites-spontanees.html` - Activit√©s spontan√©es
- `annonces.html` - Annonces

**Pages Admin:**
- `admin.html` - Dashboard admin
- `admin-add-actor.html` - Ajouter acteur manuel
- `admin-add-event.html` - Ajouter √©v√©nement manuel
- `admin-event-ai.html` - **ARTEFACT IA** (extraction √©v√©nements)
- `admin-manage-actors.html` - Gestion acteurs
- `admin-manage-events.html` - Gestion √©v√©nements
- `admin-import-google.html` - Import Google Places
- `admin-import-google-events.html` - Import Google Events

**Pages Backup/Test:**
- `carte_backup.html`
- `index-new.html`, `index-modern.html`, `index-ultra-modern.html`, `index-final.html`, `index-clean.html`

---

## üì¶ STRUCTURE DES DONN√âES

### /data/actors-data.json (468 KB, 8218 lignes)

**Structure:**
```json
{
  "commerce": [
    {
      "name": "string",
      "category": "commerce" | "restaurant" | "artisan" | "therapeute" | "service" | "association",
      "description": "string",
      "address": "string",
      "phone": "string",
      "email": "string",
      "website": "string",
      "horaires": "string",
      "specialites": ["string"],
      "lat": number,
      "lng": number,
      "image": "string (URL)",
      "rating": number,
      "reviews_count": number,
      "premium_level": "standard" | "premium" | "mega-premium"
    }
  ],
  "restaurant": [...],
  "artisan": [...],
  "therapeute": [...],
  "service": [...],
  "association": [...]
}
```

**Cat√©gories:**
- commerce
- restaurant
- artisan
- therapeute
- service
- association

**Niveaux Premium:**
- `standard`: Nom uniquement
- `premium`: Carte avec photo
- `mega-premium`: Carte compl√®te avec badge sp√©cial

### /data/events-data.json (8.7 KB)

**Structure:**
```json
[
  {
    "id": number (timestamp),
    "title": "string",
    "category": "marche" | "culture" | "sport" | "festival" | "atelier" | "theatre",
    "description": "string",
    "date": "YYYY-MM-DD",
    "time": "HH:MM",
    "location": "string",
    "address": "string",
    "price": "string",
    "organizer": "string",
    "contact": "string (email ou tel)",
    "website": "string",
    "image": "string (URL Unsplash)",
    "lat": number,
    "lng": number,
    "premium_level": "standard" | "premium" | "mega-premium"
  }
]
```

**Cat√©gories:**
- marche
- culture
- sport
- festival
- atelier
- theatre

---

## üîå API SERVERLESS EXISTANTES

### /api/github-commit.js

**Fonctionnalit√©:**
- Commit fichiers JSON sur GitHub
- Update ou cr√©ation de fichiers
- G√®re SHA pour updates
- Branch: main

**Endpoint:** `/api/github-commit`
**Method:** POST
**Body:**
```json
{
  "filePath": "cevennes-connect/data/events-data.json",
  "content": "string (JSON stringifi√©)",
  "commitMessage": "string"
}
```

**Env Variables:**
- `GITHUB_TOKEN`
- `GITHUB_REPO` (default: gaetanSimonot/cevennes-sud-website)

### /api/openai.js

**Fonctionnalit√©:**
- Proxy OpenAI API
- Extraction et reformulation d'infos
- Protection de la cl√© API

**Endpoint:** `/api/openai`
**Method:** POST
**Body:**
```json
{
  "messages": [{"role": "system|user|assistant", "content": "string"}],
  "model": "gpt-4o",
  "max_tokens": 1000,
  "temperature": 0.7
}
```

**Env Variables:**
- `OPENAI_API_KEY`

### /api/geocode.js

**Fonctionnalit√©:**
- Proxy Google Geocoding API
- Conversion adresse ‚Üí lat/lng
- Protection de la cl√© API

**Endpoint:** `/api/geocode`
**Method:** GET ou POST
**Params/Body:**
```json
{
  "address": "string"
}
```

**Env Variables:**
- `GOOGLE_MAPS_API_KEY`

---

## üé® DESIGN & STYLES

### Palette de Couleurs (par section)

- **Index/Accueil:** Emerald/Teal (vert)
- **Acteurs Locaux:** Purple/Indigo (violet)
- **√âv√©nements:** Pink/Purple (rose)
- **√âchangeons:** Blue/Cyan (bleu)
- **Parlons-en:** Orange/Red (orange)

### Framework CSS

- **Tailwind CSS** (via CDN actuellement)
- Classes utility-first
- Responsive design (breakpoints standard)
- Animations custom (floating, reveal, etc.)

### Composants visuels

**Cards:**
- Event cards (avec image, badge premium)
- Actor cards (3 niveaux d'affichage selon premium_level)
- Premium badges

**Navigation:**
- Header avec logo + menu desktop
- Dropdown "Utile" (6 sous-menus)
- Menu mobile responsive
- Footer multi-colonnes

**Filtres:**
- Boutons cat√©gories
- Barre recherche
- Toggle vue carte/liste

---

## ‚öôÔ∏è FONCTIONNALIT√âS PRINCIPALES

### 1. Affichage Public

**Acteurs Locaux:**
- Liste/grille de cards
- Filtres par cat√©gorie
- Recherche texte
- Carte Google Maps avec markers
- 3 niveaux d'affichage (standard/premium/mega-premium)

**√âv√©nements:**
- Liste chronologique
- Filtres par cat√©gorie
- Tri par date
- Cards √©v√©nements avec images
- Badges premium

**Carte Interactive:**
- Google Maps
- Markers acteurs + √©v√©nements
- Clustering
- InfoWindows d√©taill√©es
- Filtres par cat√©gorie

### 2. Interface Admin (avec Artefact IA)

**Login:**
- Protection par mot de passe
- Storage local pour session

**Dashboard:**
- Stats (nombre acteurs/√©v√©nements)
- Liens vers outils

**Artefact IA (admin-event-ai.html) - C≈íUR DU SYST√àME:**

Interface √† 3 tabs :

**Tab 1 : Screenshot/Image**
- Drop zone drag & drop
- Upload fichier image
- Preview image
- Bouton "Analyser avec IA"
- OpenAI Vision extrait les infos
- Formulaire se remplit automatiquement
- D√©tection doublons
- Bouton "Publier sur GitHub"

**Tab 2 : Texte**
- Zone textarea
- Coller du texte brut (listing √©v√©nements, etc.)
- Bouton "Analyser avec IA"
- OpenAI extrait et structure
- Formulaire se remplit automatiquement
- D√©tection doublons
- Bouton "Publier sur GitHub"

**Tab 3 : URL/Lien**
- Input URL
- Bouton "Fetch & Analyser"
- Fetch du contenu HTML
- OpenAI extrait les infos
- Formulaire se remplit automatiquement
- D√©tection doublons
- Bouton "Publier sur GitHub"

**Workflow:**
1. Admin colle contenu (texte/URL/screenshot)
2. Clic "Analyser"
3. OpenAI extrait les donn√©es structur√©es
4. Formulaire se remplit automatiquement
5. Admin v√©rifie/modifie si besoin
6. Clic "Publier"
7. D√©tection doublons (pr√©vient si existe)
8. Commit JSON sur GitHub via API
9. Vercel red√©ploie automatiquement
10. Event/Actor visible sur le site

**Import Google Places (admin-import-google.html):**
- S√©lection cat√©gorie
- Slider rayon (km autour de Ganges)
- Bouton "Importer depuis Google"
- Fetch Google Places API
- Pour chaque r√©sultat :
  - OpenAI reformule description
  - Preview de la card
- S√©lection multiple des items √† garder
- Bouton "Publier s√©lection"
- D√©tection doublons
- Commit dans actors-data.json
- Vercel red√©ploie

**Gestion Manuelle:**
- Formulaires classiques pour ajout
- √âdition d'items existants
- Suppression

### 3. Syst√®me de Commit GitHub

**Flux:**
1. Admin cr√©e/modifie un item
2. JavaScript c√¥t√© client pr√©pare le JSON
3. Appel `/api/github-commit` avec :
   - `filePath`: actors-data.json ou events-data.json
   - `content`: nouveau JSON complet (stringifi√©)
   - `commitMessage`: descriptif
4. API serverless :
   - Fetch SHA du fichier existant
   - Encode content en base64
   - PUT vers GitHub API
   - Retour success/error
5. GitHub d√©clenche Vercel webhook
6. Vercel red√©ploie automatiquement
7. Nouveau contenu visible en ~30 secondes

---

## üîë VARIABLES D'ENVIRONNEMENT

**Actuellement utilis√©es (dans Vercel):**
```
GITHUB_TOKEN=ghp_xxxxx
OPENAI_API_KEY=sk-xxxxx
GOOGLE_MAPS_API_KEY=AIzaSyCSJRp7NCeKSPiKnezVyJiJFg5dqhbWnyw
GOOGLE_PLACES_API_KEY=AIzaSyBe9S2a8Afc67NtS9UmvEwOoLt3BFne0eI
GITHUB_REPO=gaetanSimonot/cevennes-sud-website
ADMIN_PASSWORD=??? (√† v√©rifier dans le code)
```

**Cl√©s publiques (dans js/config.js):**
- `GOOGLE_MAPS_API_KEY` (OK car restriction domaine)
- `GOOGLE_PLACES_API_KEY` (OK car restriction domaine)

---

## üéØ FONCTIONNALIT√âS √Ä RECR√âER

### Pages Publiques (Next.js)

‚úÖ **app/page.tsx** - Accueil
- Hero section
- Pr√©sentation 3 services
- Stats
- CTA

‚úÖ **app/acteurs-locaux/page.tsx**
- Liste acteurs avec filtres
- Recherche
- Toggle liste/carte
- 3 niveaux d'affichage

‚úÖ **app/evenements/page.tsx**
- Liste √©v√©nements
- Filtres cat√©gories
- Tri chronologique

‚úÖ **app/carte/page.tsx**
- Google Maps
- Markers acteurs + √©v√©nements
- Filtres
- InfoWindows

‚úÖ **app/echangeons/page.tsx**
‚úÖ **app/parlons-en/page.tsx**
‚úÖ **app/covoiturage/page.tsx**
‚úÖ **app/troc-tout/page.tsx**
‚úÖ **app/boite-idees/page.tsx**
‚úÖ **app/itineraires-rando/page.tsx**
‚úÖ **app/panneau-village/page.tsx**

### Interface Admin (Next.js)

‚úÖ **app/admin/page.tsx** - Dashboard
- Login form
- Stats
- Navigation vers outils

‚úÖ **app/admin/artefact-ia/page.tsx** - ARTEFACT IA
- 3 tabs (Screenshot/Texte/URL)
- Drop zone images
- Textarea texte
- Input URL
- Bouton "Analyser avec IA"
- Formulaire auto-rempli
- D√©tection doublons
- Bouton "Publier"

‚úÖ **app/admin/import-google/page.tsx**
- S√©lection cat√©gorie
- Slider rayon
- Import Google Places
- Reformulation OpenAI
- Preview r√©sultats
- S√©lection multiple
- D√©tection doublons
- Publish

‚úÖ **app/admin/manage-actors/page.tsx**
‚úÖ **app/admin/manage-events/page.tsx**

### API Routes (Next.js App Router)

‚úÖ **app/api/github-commit/route.ts**
- Garder la logique actuelle
- TypeScript
- Validation Zod

‚úÖ **app/api/openai/route.ts**
- Garder la logique actuelle
- TypeScript

‚úÖ **app/api/geocode/route.ts**
- Garder la logique actuelle
- TypeScript

‚úÖ **app/api/extract/route.ts** (nouveau)
- Endpoint unifi√© pour extraction IA
- D√©tecte type (text/url/image)
- Appelle OpenAI
- Retourne JSON structur√©

‚úÖ **app/api/google-import/route.ts** (nouveau)
- Import Google Places
- Reformulation OpenAI
- Retourne tableau d'acteurs

---

## üìê ARCHITECTURE PROPOS√âE

```
cevennes-connect/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ layout.tsx
‚îÇ   ‚îú‚îÄ‚îÄ page.tsx (Accueil)
‚îÇ   ‚îú‚îÄ‚îÄ globals.css
‚îÇ   ‚îú‚îÄ‚îÄ acteurs-locaux/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx
‚îÇ   ‚îú‚îÄ‚îÄ evenements/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx
‚îÇ   ‚îú‚îÄ‚îÄ carte/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx
‚îÇ   ‚îú‚îÄ‚îÄ echangeons/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx
‚îÇ   ‚îú‚îÄ‚îÄ parlons-en/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx
‚îÇ   ‚îú‚îÄ‚îÄ covoiturage/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx
‚îÇ   ‚îú‚îÄ‚îÄ troc-tout/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx
‚îÇ   ‚îú‚îÄ‚îÄ boite-idees/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx
‚îÇ   ‚îú‚îÄ‚îÄ itineraires-rando/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx
‚îÇ   ‚îú‚îÄ‚îÄ panneau-village/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx
‚îÇ   ‚îú‚îÄ‚îÄ admin/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ layout.tsx (auth wrapper)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx (dashboard)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ artefact-ia/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ import-google/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ manage-actors/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ manage-events/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ page.tsx
‚îÇ   ‚îî‚îÄ‚îÄ api/
‚îÇ       ‚îú‚îÄ‚îÄ github-commit/
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ route.ts
‚îÇ       ‚îú‚îÄ‚îÄ openai/
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ route.ts
‚îÇ       ‚îú‚îÄ‚îÄ geocode/
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ route.ts
‚îÇ       ‚îú‚îÄ‚îÄ extract/
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ route.ts
‚îÇ       ‚îî‚îÄ‚îÄ google-import/
‚îÇ           ‚îî‚îÄ‚îÄ route.ts
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ ui/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Button.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Card.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Input.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Badge.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Modal.tsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Select.tsx
‚îÇ   ‚îú‚îÄ‚îÄ layout/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Header.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Footer.tsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Container.tsx
‚îÇ   ‚îú‚îÄ‚îÄ cards/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ EventCard.tsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ActorCard.tsx
‚îÇ   ‚îú‚îÄ‚îÄ maps/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ GoogleMap.tsx
‚îÇ   ‚îî‚îÄ‚îÄ admin/
‚îÇ       ‚îú‚îÄ‚îÄ LoginForm.tsx
‚îÇ       ‚îú‚îÄ‚îÄ ArtefactIA.tsx
‚îÇ       ‚îú‚îÄ‚îÄ GoogleImport.tsx
‚îÇ       ‚îî‚îÄ‚îÄ ProtectedRoute.tsx
‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îú‚îÄ‚îÄ github.ts (commit functions)
‚îÇ   ‚îú‚îÄ‚îÄ openai.ts (extraction functions)
‚îÇ   ‚îú‚îÄ‚îÄ google.ts (places API)
‚îÇ   ‚îú‚îÄ‚îÄ utils.ts (helpers)
‚îÇ   ‚îî‚îÄ‚îÄ types.ts (TypeScript types)
‚îú‚îÄ‚îÄ public/
‚îÇ   ‚îî‚îÄ‚îÄ images/
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îú‚îÄ‚îÄ actors-data.json ‚úÖ CONSERVER
‚îÇ   ‚îî‚îÄ‚îÄ events-data.json ‚úÖ CONSERVER
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ tsconfig.json
‚îú‚îÄ‚îÄ tailwind.config.ts
‚îú‚îÄ‚îÄ next.config.js
‚îî‚îÄ‚îÄ .env.local
```

---

## üö® POINTS CRITIQUES √Ä NE PAS OUBLIER

### 1. Syst√®me de Commit GitHub
**DOIT fonctionner exactement comme avant:**
- Admin ‚Üí Artefact IA ‚Üí OpenAI ‚Üí Formulaire ‚Üí Publish
- D√©tection doublons avant commit
- Commit JSON sur GitHub main branch
- Message de commit descriptif
- Vercel red√©ploie automatiquement

### 2. Artefact IA (C≈ìur du syst√®me)
**DOIT conserver:**
- 3 tabs (Screenshot/Texte/URL)
- Interface drag & drop
- Analyse OpenAI automatique
- Remplissage formulaire automatique
- Preview avant publication
- D√©tection doublons
- Logs en temps r√©el

### 3. Structure des JSON
**NE PAS modifier:**
- actors-data.json structure (cat√©gories)
- events-data.json structure (array)
- Champs existants
- Format des donn√©es

### 4. Niveaux Premium
**Syst√®me √† 3 niveaux:**
- standard: Nom seul
- premium: Card avec photo
- mega-premium: Card compl√®te + badge

### 5. Google Maps
**Fonctionnalit√©s:**
- Markers acteurs + √©v√©nements
- Clustering si nombreux points
- InfoWindows avec toutes les infos
- Filtres par cat√©gorie
- Centrage sur Ganges (43.9339, 3.7086)

### 6. Variables d'Environnement
**Toutes √† configurer dans Vercel:**
- GITHUB_TOKEN (secret)
- OPENAI_API_KEY (secret)
- GOOGLE_MAPS_API_KEY (peut √™tre public avec restrictions)
- GOOGLE_PLACES_API_KEY (peut √™tre public avec restrictions)
- ADMIN_PASSWORD (secret)
- GITHUB_REPO

---

## üìä STATISTIQUES

- **28 pages HTML** ‚Üí **~12 pages Next.js** (avec composants r√©utilisables)
- **8218 lignes** dans actors-data.json
- **250 √©v√©nements** environ dans events-data.json
- **6 cat√©gories** acteurs
- **6 cat√©gories** √©v√©nements
- **3 niveaux** premium
- **3 API routes** existantes √† conserver
- **2 nouvelles** API routes √† cr√©er

---

## ‚úÖ VALIDATION PR√â-MIGRATION

- [x] Analyse compl√®te effectu√©e
- [x] Structure JSON document√©e
- [x] API routes identifi√©es
- [x] Fonctionnalit√©s list√©es
- [x] Architecture d√©finie
- [x] Points critiques not√©s

**Pr√™t pour Phase 2 : Sauvegarde et d√©but de migration**

