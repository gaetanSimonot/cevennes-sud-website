<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sud C√©vennes Connect</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Poppins:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">

    <style>
        :root {
            --color-primary: #059669;
            --color-secondary: #ea580c;
            --color-accent: #7c3aed;
        }

        body {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            font-feature-settings: 'cv02', 'cv03', 'cv04', 'cv11';
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        }

        .font-display { font-family: 'Poppins', sans-serif; }

        /* Glassmorphism */
        .glass {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }

        .glass-strong {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(30px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        /* Gradients */
        .gradient-primary { background: linear-gradient(135deg, #059669 0%, #10b981 50%, #34d399 100%); }
        .gradient-secondary { background: linear-gradient(135deg, #ea580c 0%, #f97316 50%, #fb923c 100%); }
        .gradient-accent { background: linear-gradient(135deg, #7c3aed 0%, #8b5cf6 50%, #a78bfa 100%); }

        /* Boutons intelligents */
        .smart-btn {
            transition: all 0.6s cubic-bezier(0.23, 1, 0.320, 1);
            position: relative;
            overflow: hidden;
        }

        .smart-btn.active {
            transform: scale(1.05);
            z-index: 10;
        }

        .smart-btn.inactive {
            transform: scale(0.8);
            opacity: 0.7;
        }

        .smart-btn.inactive .btn-text,
        .smart-btn.inactive .btn-arrow {
            opacity: 0;
            transform: scale(0);
            transition: all 0.3s ease;
        }

        .smart-btn:hover:not(.active) {
            transform: scale(0.85);
            opacity: 0.9;
        }

        /* Panneau cat√©gories flottant */
        .categories-panel {
            position: fixed;
            top: 50%;
            left: 20px;
            transform: translateY(-50%);
            z-index: 1000;
            transition: all 0.4s cubic-bezier(0.23, 1, 0.320, 1);
            opacity: 0;
            transform: translateY(-50%) translateX(-100px);
        }

        .categories-panel.visible {
            opacity: 1;
            transform: translateY(-50%) translateX(0);
        }

        .category-item {
            transition: all 0.3s cubic-bezier(0.23, 1, 0.320, 1);
            border-left: 4px solid transparent;
        }

        .category-item:hover {
            background: rgba(255, 255, 255, 0.9);
            border-left-color: var(--color-primary);
            transform: translateX(5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .category-item.active {
            background: rgba(5, 150, 105, 0.1);
            border-left-color: var(--color-primary);
            transform: translateX(8px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        /* Panneau lat√©ral */
        .panel-modern {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(30px);
            border-left: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: -20px 0 60px rgba(0,0,0,0.1);
            transform: translateX(100%);
            transition: transform 0.5s cubic-bezier(0.23, 1, 0.320, 1);
        }

        .panel-modern.open {
            transform: translateX(0);
        }

        /* Cards modernes */
        .card-modern {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s cubic-bezier(0.23, 1, 0.320, 1);
        }

        .card-modern:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.12);
            border-color: rgba(5, 150, 105, 0.3);
        }

        /* Scrollbar moderne */
        .modern-scrollbar::-webkit-scrollbar { width: 6px; }
        .modern-scrollbar::-webkit-scrollbar-track { background: rgba(0,0,0,0.05); border-radius: 10px; }
        .modern-scrollbar::-webkit-scrollbar-thumb { background: linear-gradient(135deg, #059669, #10b981); border-radius: 10px; }

        /* Animations */
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .float-animation { animation: float 6s ease-in-out infinite; }
        .fade-in { animation: fadeInUp 0.8s ease-out forwards; }
        .stagger-1 { animation-delay: 0.1s; }
        .stagger-2 { animation-delay: 0.2s; }
        .stagger-3 { animation-delay: 0.3s; }

        /* Mobile */
        @media (max-width: 1024px) {
            .categories-panel {
                position: fixed;
                bottom: 20px;
                left: 20px;
                right: 20px;
                top: auto;
                transform: none;
                opacity: 0;
                transform: translateY(100px);
            }

            .categories-panel.visible {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>

<body class="min-h-screen overflow-hidden">
    <!-- Background pattern -->
    <div class="absolute inset-0 opacity-5" style="background-image: radial-gradient(circle at 2px 2px, #059669 2px, transparent 0); background-size: 40px 40px;"></div>

    <!-- Header adaptatif moderne -->
    <header class="fixed top-0 left-0 right-0 z-50 p-6">
        <div class="max-w-7xl mx-auto">
            <!-- Logo et titre -->
            <div class="text-center mb-8 fade-in">
                <div class="inline-flex items-center justify-center w-16 h-16 gradient-primary rounded-2xl shadow-2xl mb-4 float-animation">
                    <i class="fas fa-mountain text-white text-2xl"></i>
                </div>
                <h1 class="font-display font-black text-4xl lg:text-5xl text-transparent bg-clip-text bg-gradient-to-r from-gray-900 via-gray-800 to-gray-900 mb-2">
                    Sud C√©vennes
                </h1>
                <p class="text-gray-600 font-medium text-lg">Votre territoire connect√©</p>
            </div>

            <!-- Boutons intelligents -->
            <div class="flex flex-col lg:flex-row gap-6 justify-center items-center">
                <button id="btn-nous" class="smart-btn active gradient-primary text-white px-10 py-6 rounded-3xl font-bold text-lg shadow-2xl flex items-center gap-4 min-w-[280px] group fade-in stagger-1">
                    <div class="w-12 h-12 bg-white bg-opacity-20 rounded-2xl flex items-center justify-center group-hover:rotate-12 transition-transform duration-300">
                        <i class="fas fa-store text-2xl"></i>
                    </div>
                    <div class="text-left btn-text">
                        <div class="font-black text-xl">NOUS</div>
                        <div class="text-green-100 text-sm font-medium opacity-90">Acteurs locaux</div>
                    </div>
                    <i class="fas fa-arrow-right ml-auto group-hover:translate-x-1 transition-transform duration-300 btn-arrow"></i>
                </button>

                <button id="btn-echangeons" class="smart-btn inactive gradient-secondary text-white px-10 py-6 rounded-3xl font-bold text-lg shadow-2xl flex items-center gap-4 min-w-[280px] group fade-in stagger-2">
                    <div class="w-12 h-12 bg-white bg-opacity-20 rounded-2xl flex items-center justify-center group-hover:rotate-12 transition-transform duration-300">
                        <i class="fas fa-handshake text-2xl"></i>
                    </div>
                    <div class="text-left btn-text">
                        <div class="font-black text-xl">√âCHANGEONS</div>
                        <div class="text-orange-100 text-sm font-medium opacity-90">Petites annonces</div>
                    </div>
                    <i class="fas fa-arrow-right ml-auto group-hover:translate-x-1 transition-transform duration-300 btn-arrow"></i>
                </button>

                <button id="btn-moments" class="smart-btn inactive gradient-accent text-white px-10 py-6 rounded-3xl font-bold text-lg shadow-2xl flex items-center gap-4 min-w-[280px] group fade-in stagger-3">
                    <div class="w-12 h-12 bg-white bg-opacity-20 rounded-2xl flex items-center justify-center group-hover:rotate-12 transition-transform duration-300">
                        <i class="fas fa-calendar-star text-2xl"></i>
                    </div>
                    <div class="text-left btn-text">
                        <div class="font-black text-xl">DE BONS MOMENTS</div>
                        <div class="text-purple-100 text-sm font-medium opacity-90">√âv√©nements</div>
                    </div>
                    <i class="fas fa-arrow-right ml-auto group-hover:translate-x-1 transition-transform duration-300 btn-arrow"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- Carte centrale -->
    <main class="relative h-screen">
        <div id="map" class="w-full h-full relative z-10"></div>
    </main>

    <!-- Panneau cat√©gories flottant -->
    <div id="categories-panel" class="categories-panel glass-strong rounded-2xl p-4 w-72 max-h-96 overflow-y-auto modern-scrollbar">
        <div class="mb-4">
            <h3 class="font-display font-bold text-lg text-gray-800 mb-2">
                <i class="fas fa-filter mr-2 text-green-600"></i>
                Filtrer par cat√©gorie
            </h3>
            <p class="text-xs text-gray-600">Cliquez pour affiner votre recherche</p>
        </div>

        <div id="categories-list" class="space-y-2">
            <!-- G√©n√©r√© dynamiquement -->
        </div>
    </div>

    <!-- Panneau lat√©ral moderne -->
    <aside id="side-panel" class="fixed top-0 right-0 h-full w-full lg:w-[450px] panel-modern z-40">
        <div id="panel-header" class="gradient-primary text-white p-8 relative overflow-hidden">
            <div class="absolute inset-0 opacity-20" style="background-image: radial-gradient(circle at 50% 50%, rgba(255,255,255,0.2) 1px, transparent 1px); background-size: 20px 20px;"></div>
            <div class="relative z-10 flex items-center justify-between">
                <div>
                    <h2 id="panel-title" class="font-display font-black text-2xl mb-1">Acteurs locaux</h2>
                    <p id="panel-subtitle" class="text-green-100 font-medium">Commerces et services</p>
                    <p id="panel-count" class="text-green-200 text-sm mt-2">
                        <i class="fas fa-map-marker-alt mr-1"></i>
                        <span id="count-number">0</span> r√©sultats
                    </p>
                </div>
                <button id="close-panel" class="w-10 h-10 bg-white bg-opacity-20 rounded-xl flex items-center justify-center hover:bg-opacity-30 transition-all duration-300 hover:rotate-90">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
        </div>

        <div id="panel-content" class="flex-1 overflow-y-auto modern-scrollbar bg-gradient-to-b from-white to-gray-50 p-6">
            <!-- Contenu g√©n√©r√© dynamiquement -->
        </div>
    </aside>

    <!-- Bouton flottant mobile -->
    <button id="mobile-panel-btn" class="fixed bottom-8 right-8 w-16 h-16 gradient-primary rounded-2xl shadow-2xl z-50 flex items-center justify-center text-white text-xl hover:scale-110 transition-transform duration-300 lg:hidden">
        <i class="fas fa-list"></i>
    </button>

    <!-- Scripts -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
        // ==================== DONN√âES D'EXEMPLE ====================
        const mockData = {
            nous: {
                restaurants: [
                    { id: 1, name: "Le Bistrot de Ganges", category: "restaurant", address: "12 Place du March√©, Ganges", phone: "04.67.73.85.42", description: "Cuisine traditionnelle avec produits locaux, terrasse ombrag√©e", lat: 43.9344, lng: 3.6789, rating: 4.5 },
                    { id: 2, name: "Pizza Luna", category: "restaurant", address: "Avenue de la Libert√©, Ganges", phone: "04.67.73.92.15", description: "Pizzeria artisanale, p√¢te fra√Æche maison, livraison possible", lat: 43.9354, lng: 3.6799, rating: 4.2 },
                    { id: 3, name: "L'Auberge des C√©vennes", category: "restaurant", address: "Route de Sum√®ne, Saint-Bauzille", phone: "04.67.82.14.36", description: "Restaurant gastronomique, vue panoramique sur les montagnes", lat: 43.9444, lng: 3.6889, rating: 4.8 }
                ],
                sante: [
                    { id: 4, name: "Cabinet Dr. Martin", category: "sante", address: "8 Rue de la R√©publique, Ganges", phone: "04.67.73.41.22", description: "M√©decine g√©n√©rale, consultations sur RDV, m√©decin de famille", lat: 43.9324, lng: 3.6769, rating: 4.6 },
                    { id: 5, name: "Pharmacie des C√©vennes", category: "sante", address: "Place Jean Jaur√®s, Ganges", phone: "04.67.73.85.14", description: "Pharmacie, parapharmacie, conseils sant√© et bien-√™tre", lat: 43.9334, lng: 3.6779, rating: 4.4 },
                    { id: 6, name: "Cabinet Kin√© Dubois", category: "sante", address: "15 Avenue du Pont, Saint-Hippolyte", phone: "04.67.81.23.45", description: "Kin√©sith√©rapie, r√©√©ducation, th√©rapie manuelle", lat: 43.9644, lng: 3.7089, rating: 4.7 }
                ],
                artisans: [
                    { id: 7, name: "Menuiserie C√©venole", category: "artisan", address: "Zone Artisanale, Ganges", phone: "04.67.73.67.89", description: "Menuiserie sur mesure, charpente traditionnelle, agencement", lat: 43.9244, lng: 3.6689, rating: 4.5 },
                    { id: 8, name: "Plomberie D√©pann'", category: "artisan", address: "12 Rue des Artisans, Sum√®ne", phone: "04.67.82.45.67", description: "Plomberie, chauffage, d√©pannage 24h/24, devis gratuit", lat: 43.9544, lng: 3.6989, rating: 4.3 }
                ],
                commerces: [
                    { id: 9, name: "√âpicerie Bio Locale", category: "commerce", address: "6 Rue du Commerce, Ganges", phone: "04.67.73.28.91", description: "Produits bio et locaux, fruits et l√©gumes de saison", lat: 43.9364, lng: 3.6809, rating: 4.4 },
                    { id: 10, name: "Boulangerie du Village", category: "commerce", address: "2 Place de l'√âglise, Saint-Bauzille", phone: "04.67.82.17.33", description: "Pain artisanal, viennoiseries, p√¢tisseries maison", lat: 43.9464, lng: 3.6909, rating: 4.6 }
                ]
            },
            echangeons: [
                { id: 1, title: "iPhone 14 Pro - √âtat parfait", description: "iPhone 14 Pro 128GB, achet√© il y a 6 mois, toujours sous garantie Apple Care+", price: 850, type: "vente", category: "tech", location: "Ganges", date: "2024-12-20", contact: "Sophie M." },
                { id: 2, title: "Cours de guitare", description: "Professeur exp√©riment√© donne cours de guitare tous styles √† domicile", price: 0, priceText: "25‚Ç¨/h", type: "service", category: "loisirs", location: "Saint-Hippolyte-du-Fort", date: "2024-12-19", contact: "Antoine M." },
                { id: 3, title: "L√©gumes bio du potager", description: "Courgettes, tomates, aubergines de mon potager bio √† r√©cup√©rer", price: 0, priceText: "Gratuit", type: "don", category: "alimentaire", location: "Sum√®ne", date: "2024-12-18", contact: "Jean-Pierre L." },
                { id: 4, title: "VTT D√©cathlon Rockrider", description: "VTT adulte en tr√®s bon √©tat, r√©vision r√©cente, id√©al randonn√©es", price: 280, type: "vente", category: "sport", location: "Ganges", date: "2024-12-17", contact: "Marc T." }
            ],
            moments: [
                { id: 1, title: "March√© hebdomadaire", description: "Grand march√© avec producteurs locaux, tous les vendredis matin", date: "2024-12-27", time: "8h00-13h00", location: "Place du March√©, Ganges", price: "Gratuit", category: "marche", lat: 43.9344, lng: 3.6789 },
                { id: 2, title: "Concert de No√´l", description: "Concert de la chorale locale dans l'√©glise romane", date: "2024-12-24", time: "20h30", location: "√âglise Saint-Pierre, Ganges", price: "10‚Ç¨", category: "culture", lat: 43.9354, lng: 3.6779 },
                { id: 3, title: "Randonn√©e d√©couverte", description: "Randonn√©e guid√©e sur les sentiers c√©venols, niveau facile", date: "2024-12-29", time: "9h00-17h00", location: "Parking Mairie, Saint-Hippolyte", price: "15‚Ç¨", category: "nature", lat: 43.9644, lng: 3.7089 },
                { id: 4, title: "Atelier poterie", description: "Initiation poterie pour enfants, mat√©riel fourni", date: "2025-01-03", time: "14h00-16h00", location: "Salle des associations, Sum√®ne", price: "8‚Ç¨", category: "famille", lat: 43.9544, lng: 3.6989 }
            ]
        };

        // ==================== VARIABLES GLOBALES ====================
        let map;
        let currentMode = 'nous';
        let currentCategory = 'all';
        let currentMarkers = [];

        const categoryConfig = {
            nous: {
                all: { label: 'Tout voir', icon: 'fas fa-th-large', color: 'text-gray-700', desc: 'Tous les acteurs locaux' },
                restaurant: { label: 'Restaurants', icon: 'fas fa-utensils', color: 'text-red-600', desc: 'Bistrot, pizzeria, gastronomie' },
                sante: { label: 'Sant√©', icon: 'fas fa-user-md', color: 'text-blue-600', desc: 'M√©decins, pharmacies, th√©rapeutes' },
                artisan: { label: 'Artisans', icon: 'fas fa-hammer', color: 'text-amber-600', desc: 'Menuiserie, plomberie, √©lectricit√©' },
                commerce: { label: 'Commerces', icon: 'fas fa-store', color: 'text-green-600', desc: 'Alimentation, mode, √©quipement' }
            },
            echangeons: {
                all: { label: 'Toutes annonces', icon: 'fas fa-list', color: 'text-gray-700', desc: 'Toutes les petites annonces' },
                vente: { label: 'Vente', icon: 'fas fa-tag', color: 'text-green-600', desc: 'Objets √† vendre' },
                don: { label: 'Don', icon: 'fas fa-gift', color: 'text-blue-600', desc: 'Objets gratuits' },
                service: { label: 'Services', icon: 'fas fa-handshake', color: 'text-purple-600', desc: 'Services entre voisins' }
            },
            moments: {
                all: { label: 'Tous √©v√©nements', icon: 'fas fa-calendar', color: 'text-gray-700', desc: 'Tous les √©v√©nements' },
                culture: { label: 'Culture', icon: 'fas fa-theater-masks', color: 'text-purple-600', desc: 'Concerts, spectacles' },
                nature: { label: 'Nature', icon: 'fas fa-tree', color: 'text-green-600', desc: 'Randonn√©es, sorties nature' },
                famille: { label: 'Famille', icon: 'fas fa-users', color: 'text-pink-600', desc: 'Ateliers enfants' },
                marche: { label: 'March√©s', icon: 'fas fa-shopping-basket', color: 'text-amber-600', desc: 'March√©s, brocantes' }
            }
        };

        // ==================== INITIALISATION ====================
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Sud C√©vennes Connect Clean');

            initMap();
            initEventListeners();
            switchMode('nous');

            // Afficher les cat√©gories apr√®s un d√©lai
            setTimeout(() => {
                showCategories();
            }, 1000);
        });

        // ==================== CARTE ====================
        function initMap() {
            map = L.map('map', { zoomControl: false }).setView([43.9344, 3.6789], 12);
            L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png').addTo(map);
            L.control.zoom({ position: 'bottomleft' }).addTo(map);
        }

        // ==================== √âV√âNEMENTS ====================
        function initEventListeners() {
            document.getElementById('btn-nous').addEventListener('click', () => switchMode('nous'));
            document.getElementById('btn-echangeons').addEventListener('click', () => switchMode('echangeons'));
            document.getElementById('btn-moments').addEventListener('click', () => switchMode('moments'));
            document.getElementById('close-panel').addEventListener('click', closePanel);
            document.getElementById('mobile-panel-btn').addEventListener('click', openPanel);
        }

        // ==================== GESTION DES MODES ====================
        function switchMode(mode) {
            console.log(`Mode: ${mode}`);
            currentMode = mode;
            currentCategory = 'all';

            updateButtons();
            updateCategories();
            updateContent();
            updateMap();
            openPanel();
        }

        function updateButtons() {
            document.querySelectorAll('.smart-btn').forEach(btn => {
                const btnMode = btn.id.replace('btn-', '');
                if (btnMode === currentMode) {
                    btn.classList.remove('inactive');
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                    btn.classList.add('inactive');
                }
            });
        }

        function showCategories() {
            document.getElementById('categories-panel').classList.add('visible');
        }

        function hideCategories() {
            document.getElementById('categories-panel').classList.remove('visible');
        }

        function updateCategories() {
            const container = document.getElementById('categories-list');
            const categories = categoryConfig[currentMode];

            container.innerHTML = Object.entries(categories).map(([key, config]) => `
                <div class="category-item glass p-3 rounded-xl cursor-pointer ${key === currentCategory ? 'active' : ''}" onclick="selectCategory('${key}')">
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 bg-gradient-to-br from-gray-100 to-gray-200 rounded-lg flex items-center justify-center flex-shrink-0">
                            <i class="${config.icon} ${config.color} text-sm"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="font-semibold text-gray-800 text-sm">${config.label}</div>
                            <div class="text-xs text-gray-500 truncate">${config.desc}</div>
                        </div>
                        <div class="w-6 h-6 bg-green-100 rounded-full flex items-center justify-center">
                            <span class="text-xs font-bold text-green-700" id="count-${key}">0</span>
                        </div>
                    </div>
                </div>
            `).join('');

            updateCategoryCounts();
        }

        function selectCategory(category) {
            currentCategory = category;
            updateCategories();
            updateContent();
            updateMap();
        }

        function updateCategoryCounts() {
            const data = getData();
            const categories = categoryConfig[currentMode];

            Object.keys(categories).forEach(key => {
                let count;
                if (key === 'all') {
                    count = data.length;
                } else if (currentMode === 'nous') {
                    count = data.filter(item => item.category === key).length;
                } else {
                    count = data.filter(item => item.category === key || item.type === key).length;
                }

                const element = document.getElementById(`count-${key}`);
                if (element) element.textContent = count;
            });
        }

        // ==================== CONTENU ====================
        function updateContent() {
            const config = {
                nous: { title: 'Acteurs locaux', subtitle: 'Commerces et services', gradient: 'gradient-primary' },
                echangeons: { title: 'Petites annonces', subtitle: 'Don, troc, vente', gradient: 'gradient-secondary' },
                moments: { title: 'De bons moments', subtitle: '√âv√©nements et sorties', gradient: 'gradient-accent' }
            };

            const modeConfig = config[currentMode];
            document.getElementById('panel-header').className = `${modeConfig.gradient} text-white p-8 relative overflow-hidden`;
            document.getElementById('panel-title').textContent = modeConfig.title;
            document.getElementById('panel-subtitle').textContent = modeConfig.subtitle;

            const data = getFilteredData();
            document.getElementById('count-number').textContent = data.length;

            const container = document.getElementById('panel-content');

            if (currentMode === 'nous') {
                updateBusinessContent(container, data);
            } else if (currentMode === 'echangeons') {
                updateListingsContent(container, data);
            } else if (currentMode === 'moments') {
                updateEventsContent(container, data);
            }
        }

        function updateBusinessContent(container, data) {
            container.innerHTML = data.map(business => `
                <div class="card-modern p-5 rounded-2xl mb-4 cursor-pointer" onclick="focusOnLocation(${business.lat}, ${business.lng})">
                    <div class="flex items-start gap-4">
                        <div class="w-12 h-12 bg-gradient-to-br from-green-100 to-green-200 rounded-xl flex items-center justify-center flex-shrink-0">
                            <i class="fas fa-${business.category === 'restaurant' ? 'utensils' : business.category === 'sante' ? 'user-md' : business.category === 'artisan' ? 'hammer' : 'store'} text-green-600 text-xl"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3 class="font-bold text-lg text-gray-900 mb-1">${business.name}</h3>
                            <p class="text-sm text-gray-600 mb-3 line-clamp-2">${business.description}</p>
                            <div class="space-y-2 text-sm">
                                <div class="flex items-center gap-2 text-gray-500">
                                    <i class="fas fa-map-marker-alt text-green-500 w-4"></i>
                                    <span class="truncate">${business.address}</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <i class="fas fa-phone text-blue-500 w-4"></i>
                                    <a href="tel:${business.phone}" class="text-blue-600 hover:underline">${business.phone}</a>
                                </div>
                                <div class="flex items-center gap-2">
                                    <i class="fas fa-star text-yellow-500 w-4"></i>
                                    <span class="text-yellow-600 font-medium">${business.rating}/5</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function updateListingsContent(container, data) {
            container.innerHTML = data.map(listing => `
                <div class="card-modern p-5 rounded-2xl mb-4">
                    <div class="flex items-start justify-between mb-3">
                        <h3 class="font-bold text-lg text-gray-900 flex-1">${listing.title}</h3>
                        <div class="text-right ml-4">
                            <div class="font-bold text-xl text-orange-600">${listing.priceText || listing.price + '‚Ç¨'}</div>
                            <span class="text-xs px-2 py-1 rounded-full bg-orange-100 text-orange-800 capitalize">${listing.type}</span>
                        </div>
                    </div>
                    <p class="text-sm text-gray-600 mb-3">${listing.description}</p>
                    <div class="flex items-center justify-between text-sm">
                        <div class="space-y-1 text-gray-500">
                            <div><i class="fas fa-map-marker-alt mr-1"></i>${listing.location}</div>
                            <div><i class="fas fa-user mr-1"></i>${listing.contact}</div>
                            <div><i class="fas fa-clock mr-1"></i>${formatDate(listing.date)}</div>
                        </div>
                        <button class="px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors">
                            <i class="fas fa-phone mr-1"></i>Contacter
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function updateEventsContent(container, data) {
            container.innerHTML = data.map(event => `
                <div class="card-modern p-5 rounded-2xl mb-4 cursor-pointer" onclick="focusOnLocation(${event.lat || 43.9344}, ${event.lng || 3.6789})">
                    <div class="flex items-start gap-4">
                        <div class="w-12 h-12 bg-gradient-to-br from-purple-100 to-purple-200 rounded-xl flex items-center justify-center flex-shrink-0">
                            <i class="fas fa-calendar text-purple-600 text-xl"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3 class="font-bold text-lg text-gray-900 mb-1">${event.title}</h3>
                            <p class="text-sm text-gray-600 mb-3">${event.description}</p>
                            <div class="space-y-2 text-sm">
                                <div class="flex items-center gap-2 text-gray-500">
                                    <i class="fas fa-calendar text-purple-500 w-4"></i>
                                    <span>${formatDate(event.date)} ‚Ä¢ ${event.time}</span>
                                </div>
                                <div class="flex items-center gap-2 text-gray-500">
                                    <i class="fas fa-map-marker-alt text-purple-500 w-4"></i>
                                    <span class="truncate">${event.location}</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <i class="fas fa-ticket-alt text-purple-500 w-4"></i>
                                    <span class="font-semibold text-purple-600">${event.price}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // ==================== CARTE ET MARKERS ====================
        function updateMap() {
            currentMarkers.forEach(marker => map.removeLayer(marker));
            currentMarkers = [];

            const data = getFilteredData();

            data.forEach(item => {
                if (item.lat && item.lng) {
                    const color = currentMode === 'nous' ? '#059669' : currentMode === 'echangeons' ? '#ea580c' : '#7c3aed';
                    const icon = L.divIcon({
                        html: `<div style="background: ${color}; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; border: 3px solid white; box-shadow: 0 4px 12px rgba(0,0,0,0.3); color: white; font-size: 16px;">
                            ${getItemIcon(item)}
                        </div>`,
                        className: 'custom-marker',
                        iconSize: [32, 32],
                        iconAnchor: [16, 16]
                    });

                    const marker = L.marker([item.lat, item.lng], { icon }).addTo(map);

                    marker.bindPopup(`
                        <div class="p-4 min-w-[280px]">
                            <h3 class="font-bold text-lg mb-2">${item.name || item.title}</h3>
                            <p class="text-sm text-gray-600 mb-3">${item.description}</p>
                            <div class="text-sm space-y-1">
                                <div><i class="fas fa-map-marker-alt mr-2 text-gray-500"></i>${item.address || item.location}</div>
                                ${item.phone ? `<div><i class="fas fa-phone mr-2 text-gray-500"></i><a href="tel:${item.phone}" class="text-blue-600">${item.phone}</a></div>` : ''}
                                ${item.rating ? `<div><i class="fas fa-star mr-2 text-yellow-500"></i><span class="text-yellow-600">${item.rating}/5</span></div>` : ''}
                            </div>
                        </div>
                    `);

                    currentMarkers.push(marker);
                }
            });
        }

        // ==================== PANNEAU LAT√âRAL ====================
        function openPanel() {
            document.getElementById('side-panel').classList.add('open');
            if (window.innerWidth <= 1024) {
                document.getElementById('mobile-panel-btn').style.display = 'none';
            }
        }

        function closePanel() {
            document.getElementById('side-panel').classList.remove('open');
            if (window.innerWidth <= 1024) {
                document.getElementById('mobile-panel-btn').style.display = 'flex';
            }
        }

        // ==================== UTILITAIRES ====================
        function getData() {
            return currentMode === 'nous' ? Object.values(mockData.nous).flat() : mockData[currentMode];
        }

        function getFilteredData() {
            const data = getData();
            if (currentCategory === 'all') return data;

            if (currentMode === 'nous') {
                return data.filter(item => item.category === currentCategory);
            } else if (currentMode === 'echangeons') {
                return data.filter(item => item.category === currentCategory || item.type === currentCategory);
            } else {
                return data.filter(item => item.category === currentCategory);
            }
        }

        function getItemIcon(item) {
            if (currentMode === 'nous') {
                const icons = { restaurant: 'üçΩÔ∏è', sante: 'üè•', artisan: 'üîß', commerce: 'üõí' };
                return icons[item.category] || 'üìç';
            } else if (currentMode === 'moments') {
                return 'üìÖ';
            }
            return 'üí¨';
        }

        function formatDate(dateString) {
            return new Date(dateString).toLocaleDateString('fr-FR', {
                day: 'numeric', month: 'short'
            });
        }

        function focusOnLocation(lat, lng) {
            map.setView([lat, lng], 16);
            if (window.innerWidth <= 1024) {
                setTimeout(() => closePanel(), 500);
            }
        }
    </script>
</body>
</html>