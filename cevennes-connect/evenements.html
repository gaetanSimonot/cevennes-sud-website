<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Événements - Cévennes Sud</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Playfair+Display:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- Google Maps API -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCSJRp7NCeKSPiKnezVyJiJFg5dqhbWnyw&libraries=marker&callback=Function.prototype" defer></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            line-height: 1.6;
            background-color: #fafafa;
        }

        .font-display {
            font-family: 'Playfair Display', serif;
        }

        /* Hero Section */
        .hero-background {
            background: linear-gradient(135deg, rgba(147, 51, 234, 0.9) 0%, rgba(126, 34, 206, 0.95) 50%, rgba(107, 33, 168, 0.98) 100%),
                        url('https://images.unsplash.com/photo-1492684223066-81342ee5ff30?ixlib=rb-4.0.3&auto=format&fit=crop&w=2000&q=80') center/cover;
            background-attachment: fixed;
            position: relative;
            overflow: hidden;
        }

        /* Floating Elements Animation */
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            33% { transform: translateY(-20px) rotate(2deg); }
            66% { transform: translateY(10px) rotate(-1deg); }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(60px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .floating {
            animation: float 6s ease-in-out infinite;
        }

        /* Premium Card Styles */
        .premium-card {
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.95), rgba(248, 250, 252, 0.9));
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.08), 0 8px 16px rgba(0, 0, 0, 0.05);
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            position: relative;
            overflow: hidden;
        }

        .premium-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #9333ea, #7e22ce, #6b21a8);
        }

        .premium-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.12), 0 12px 24px rgba(0, 0, 0, 0.08);
            border-color: rgba(147, 51, 234, 0.3);
        }

        /* Navigation Improvements */
        .nav-backdrop {
            backdrop-filter: blur(20px);
            background: rgba(255, 255, 255, 0.95);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        }

        /* Map Styling */
        .map-container {
            height: 500px;
            border-radius: 24px;
            overflow: hidden;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        /* Filter Buttons */
        .filter-btn {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(147, 51, 234, 0.2);
            transition: all 0.3s ease;
        }

        .filter-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(147, 51, 234, 0.15);
        }

        .filter-btn.active {
            background: linear-gradient(135deg, #9333ea, #7e22ce);
            color: white;
            border-color: rgba(147, 51, 234, 0.3);
        }

        /* Search Box */
        .search-box {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(147, 51, 234, 0.2);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.05);
        }

        /* Event Cards */
        .event-card {
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.95), rgba(248, 250, 252, 0.9));
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.06);
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            position: relative;
            overflow: hidden;
        }

        .event-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #9333ea, #7e22ce);
        }

        .event-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 25px 50px rgba(147, 51, 234, 0.15), 0 10px 25px rgba(0, 0, 0, 0.08);
        }

        /* Calendar Styles */
        .calendar-container {
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.95), rgba(248, 250, 252, 0.9));
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.08);
        }

        .calendar-day {
            transition: all 0.3s ease;
            position: relative;
        }

        .calendar-day:hover {
            background-color: rgba(147, 51, 234, 0.1);
        }

        .calendar-day.has-events {
            background-color: rgba(147, 51, 234, 0.1);
            font-weight: 600;
        }

        .calendar-day.has-events::after {
            content: '';
            position: absolute;
            bottom: 4px;
            left: 50%;
            transform: translateX(-50%);
            width: 6px;
            height: 6px;
            background-color: #9333ea;
            border-radius: 50%;
        }

        .calendar-day.selected {
            background: linear-gradient(135deg, #9333ea, #7e22ce);
            color: white;
        }

        /* Scroll Animations */
        .reveal {
            opacity: 0;
            transform: translateY(40px);
            transition: all 0.8s ease-out;
        }

        .reveal.active {
            opacity: 1;
            transform: translateY(0);
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f5f9;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #9333ea, #7e22ce);
            border-radius: 4px;
        }

        /* Category Icons */
        .category-festival { color: #f59e0b; }
        .category-marche { color: #10b981; }
        .category-culture { color: #ef4444; }
        .category-sport { color: #06b6d4; }
        .category-atelier { color: #8b5cf6; }
        .category-concert { color: #ec4899; }

        /* Hero Text Animations */
        .hero-title {
            animation: fadeInUp 1s ease-out 0.2s both;
        }

        .hero-subtitle {
            animation: fadeInUp 1s ease-out 0.4s both;
        }

        /* Mobile Optimizations */
        @media (max-width: 640px) {
            .hero-background {
                background-attachment: scroll;
                min-height: 90vh;
            }

            .hero-title {
                font-size: 2.5rem;
                line-height: 1.2;
            }

            .hero-subtitle {
                font-size: 1.1rem;
            }

            .container {
                padding-left: 1rem;
                padding-right: 1rem;
            }
        }

        @media (max-width: 480px) {
            .hero-title {
                font-size: 2rem;
            }

            .hero-subtitle {
                font-size: 1rem;
            }

            .premium-card:hover,
            .event-card:hover {
                transform: none;
            }
        }
    </style>
</head>

<body>
    <!-- Navigation -->
    <nav class="nav-backdrop fixed w-full top-0 z-50 transition-all duration-300">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-4">
                <!-- Logo -->
                <div class="flex items-center space-x-3 mr-8">
                    <div class="w-12 h-12 bg-gradient-to-br from-purple-500 to-purple-600 rounded-2xl flex items-center justify-center shadow-lg">
                        <i class="fas fa-mountain text-white text-xl"></i>
                    </div>
                    <div>
                        <h1 class="font-display font-bold text-2xl bg-gradient-to-r from-gray-900 to-gray-700 bg-clip-text text-transparent">Cévennes Sud</h1>
                        <p class="text-sm text-gray-500 font-medium">Votre communauté locale</p>
                    </div>
                </div>

                <!-- Desktop Menu -->
                <div class="hidden md:flex space-x-8">
                    <a href="index.html" class="text-gray-700 hover:text-purple-600 transition-colors text-lg relative group">
                        Accueil
                        <span class="absolute -bottom-1 left-0 w-0 h-0.5 bg-purple-600 transition-all duration-300 group-hover:w-full"></span>
                    </a>
                    <a href="acteurs-locaux.html" class="text-gray-700 hover:text-purple-600 transition-colors text-lg relative group">
                        Acteurs Locaux
                        <span class="absolute -bottom-1 left-0 w-0 h-0.5 bg-purple-600 transition-all duration-300 group-hover:w-full"></span>
                    </a>
                    <a href="evenements.html" class="text-purple-600 font-semibold text-lg relative group">
                        Événements
                        <span class="absolute -bottom-1 left-0 w-full h-0.5 bg-purple-600"></span>
                    </a>
                    <a href="echangeons.html" class="text-gray-700 hover:text-purple-600 transition-colors text-lg relative group">
                        Petites Annonces
                        <span class="absolute -bottom-1 left-0 w-0 h-0.5 bg-purple-600 transition-all duration-300 group-hover:w-full"></span>
                    </a>
                    <a href="parlons-en.html" class="text-gray-700 hover:text-purple-600 transition-colors text-lg relative group">
                        Parlons-en
                        <span class="absolute -bottom-1 left-0 w-0 h-0.5 bg-purple-600 transition-all duration-300 group-hover:w-full"></span>
                    </a>
                    <a href="troc-tout.html" class="text-gray-700 hover:text-purple-600 transition-colors text-lg relative group">
                        Troc Tout
                        <span class="absolute -bottom-1 left-0 w-0 h-0.5 bg-purple-600 transition-all duration-300 group-hover:w-full"></span>
                    </a>
                    <a href="panneau-village.html" class="text-gray-700 hover:text-purple-600 transition-colors text-lg relative group">
                        Panneau du Village
                        <span class="absolute -bottom-1 left-0 w-0 h-0.5 bg-purple-600 transition-all duration-300 group-hover:w-full"></span>
                    </a>
                </div>

                <!-- Mobile Menu Button -->
                <button id="mobile-menu-btn" class="md:hidden p-2 rounded-xl bg-gray-100 hover:bg-gray-200 transition-colors">
                    <i class="fas fa-bars text-xl text-gray-700"></i>
                </button>
            </div>

            <!-- Mobile Menu -->
            <div id="mobile-menu" class="md:hidden hidden bg-white/95 backdrop-blur-xl rounded-2xl mt-4 p-6 shadow-xl border border-white/20">
                <div class="space-y-4">
                    <a href="index.html" class="block text-gray-700 hover:text-purple-600 transition-colors text-lg">Accueil</a>
                    <a href="acteurs-locaux.html" class="block text-gray-700 hover:text-purple-600 transition-colors text-lg">Acteurs Locaux</a>
                    <a href="evenements.html" class="block text-purple-600 font-semibold text-lg">Événements</a>
                    <a href="echangeons.html" class="block text-gray-700 hover:text-purple-600 transition-colors text-lg">Petites Annonces</a>
                    <a href="parlons-en.html" class="block text-gray-700 hover:text-purple-600 transition-colors text-lg">Parlons-en</a>
                    <a href="troc-tout.html" class="block text-gray-700 hover:text-purple-600 transition-colors text-lg">Troc Tout</a>
                    <a href="panneau-village.html" class="block text-gray-700 hover:text-purple-600 transition-colors text-lg">Panneau du Village</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero-background pt-20 pb-12 text-white relative overflow-hidden">
        <!-- Floating Elements -->
        <div class="absolute top-20 left-10 floating opacity-20">
            <div class="w-20 h-20 bg-white/10 rounded-full blur-sm"></div>
        </div>
        <div class="absolute bottom-10 right-16 floating opacity-30" style="animation-delay: 2s;">
            <div class="w-12 h-12 bg-purple-400/20 rounded-full blur-sm"></div>
        </div>
        <div class="absolute top-1/2 right-1/4 floating opacity-25" style="animation-delay: 4s;">
            <div class="w-16 h-16 bg-violet-300/15 rounded-full blur-sm"></div>
        </div>

        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center relative z-10">
            <!-- Icon -->
            <div class="hero-title mb-6">
                <div class="w-20 h-20 mx-auto mb-4 bg-white/20 backdrop-blur-lg rounded-3xl flex items-center justify-center shadow-2xl floating">
                    <i class="fas fa-calendar-star text-white text-3xl"></i>
                </div>
            </div>

            <!-- Title -->
            <h1 class="hero-title font-display font-bold text-4xl sm:text-5xl lg:text-6xl mb-6">
                Événements
            </h1>

            <!-- Subtitle -->
            <p class="hero-subtitle text-xl sm:text-2xl text-white/90 max-w-4xl mx-auto leading-relaxed">
                Découvrez les concerts, marchés, festivals, ateliers et animations de votre région
            </p>
        </div>
    </section>

    <!-- Main Content -->
    <section class="py-16 bg-gradient-to-br from-gray-50 to-gray-100">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <!-- Admin Buttons -->
            <div class="mb-12 text-center reveal">
                <div class="flex flex-wrap gap-4 justify-center">
                    <a href="admin-add-event.html" class="inline-block bg-gradient-to-r from-purple-500 to-indigo-500 text-white px-10 py-4 rounded-2xl text-lg font-semibold shadow-xl hover:shadow-2xl hover:scale-105 transition-all duration-300">
                        <i class="fas fa-plus mr-3"></i>Créer un événement
                    </a>
                    <a href="admin-event-ai.html" class="inline-block bg-gradient-to-r from-pink-500 to-rose-500 text-white px-10 py-4 rounded-2xl text-lg font-semibold shadow-xl hover:shadow-2xl hover:scale-105 transition-all duration-300">
                        <i class="fas fa-magic mr-3"></i>Artefact IA
                    </a>
                    <a href="admin-import-google-events.html" class="inline-block bg-gradient-to-r from-orange-500 to-red-500 text-white px-10 py-4 rounded-2xl text-lg font-semibold shadow-xl hover:shadow-2xl hover:scale-105 transition-all duration-300">
                        <i class="fas fa-robot mr-3"></i>Import Auto Google Events
                    </a>
                </div>
            </div>

            <!-- Search and Filters -->
            <div class="mb-12 reveal">
                <div class="flex flex-col lg:flex-row gap-6">
                    <!-- Search Bar -->
                    <div class="flex-1">
                        <div class="search-box rounded-2xl p-4">
                            <div class="relative">
                                <i class="fas fa-search absolute left-4 top-1/2 transform -translate-y-1/2 text-purple-500 text-lg"></i>
                                <input
                                    type="text"
                                    id="searchInput"
                                    placeholder="Rechercher un événement, lieu, organisateur..."
                                    class="w-full pl-12 pr-4 py-3 bg-transparent border-0 focus:ring-0 focus:outline-none text-lg placeholder-gray-500"
                                >
                            </div>
                        </div>
                    </div>

                    <!-- Category Filters -->
                    <div class="flex flex-wrap gap-3 justify-center">
                        <button class="filter-btn active px-6 py-3 rounded-xl font-semibold text-sm transition-all" data-category="all">
                            <i class="fas fa-th-large mr-2"></i>Tous
                        </button>
                        <button class="filter-btn px-6 py-3 rounded-xl font-semibold text-sm transition-all" data-category="festival">
                            <i class="fas fa-music mr-2 category-festival"></i>Festivals
                        </button>
                        <button class="filter-btn px-6 py-3 rounded-xl font-semibold text-sm transition-all" data-category="marche">
                            <i class="fas fa-shopping-basket mr-2 category-marche"></i>Marchés
                        </button>
                        <button class="filter-btn px-6 py-3 rounded-xl font-semibold text-sm transition-all" data-category="culture">
                            <i class="fas fa-theater-masks mr-2 category-culture"></i>Culture
                        </button>
                        <button class="filter-btn px-6 py-3 rounded-xl font-semibold text-sm transition-all" data-category="sport">
                            <i class="fas fa-running mr-2 category-sport"></i>Sport
                        </button>
                        <button class="filter-btn px-6 py-3 rounded-xl font-semibold text-sm transition-all" data-category="atelier">
                            <i class="fas fa-tools mr-2 category-atelier"></i>Ateliers
                        </button>
                    </div>

                    <!-- View Toggle -->
                    <div class="flex justify-center mt-6">
                        <div class="bg-white rounded-xl p-1 shadow-lg border border-gray-200">
                            <button id="cardView" class="view-toggle active px-4 py-2 rounded-lg font-medium text-sm transition-all">
                                <i class="fas fa-th-large mr-2"></i>Cartes
                            </button>
                            <button id="listView" class="view-toggle px-4 py-2 rounded-lg font-medium text-sm transition-all">
                                <i class="fas fa-list mr-2"></i>Liste
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Calendar and Map Section -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-16">
                <!-- Calendar -->
                <div class="reveal">
                    <div class="calendar-container rounded-3xl p-8">
                        <div class="flex items-center justify-between mb-6">
                            <h2 class="font-display font-bold text-2xl text-gray-900">
                                <i class="fas fa-calendar-alt mr-3 text-purple-600"></i>
                                Calendrier
                            </h2>
                            <div class="flex space-x-2">
                                <button id="prevMonth" class="bg-purple-100 text-purple-600 px-3 py-2 rounded-lg hover:bg-purple-200 transition-colors">
                                    <i class="fas fa-chevron-left"></i>
                                </button>
                                <button id="nextMonth" class="bg-purple-100 text-purple-600 px-3 py-2 rounded-lg hover:bg-purple-200 transition-colors">
                                    <i class="fas fa-chevron-right"></i>
                                </button>
                            </div>
                        </div>
                        <div id="calendar" class="calendar-grid"></div>
                    </div>
                </div>

                <!-- Map -->
                <div class="reveal">
                    <div class="premium-card rounded-3xl p-8">
                        <div class="flex items-center justify-between mb-6">
                            <h2 class="font-display font-bold text-2xl text-gray-900">
                                <i class="fas fa-map-marked-alt mr-3 text-purple-600"></i>
                                Carte des Événements
                            </h2>
                            <div class="flex space-x-3">
                                <button onclick="centerMap()" class="bg-purple-100 text-purple-600 px-4 py-2 rounded-xl font-medium hover:bg-purple-200 transition-colors">
                                    <i class="fas fa-crosshairs mr-2"></i>Centrer
                                </button>
                            </div>
                        </div>
                        <div id="map" class="map-container"></div>
                    </div>
                </div>
            </div>

            <!-- Events List -->
            <div class="reveal">
                <h2 class="font-display font-bold text-3xl text-gray-900 mb-8 text-center">
                    Prochains Événements
                </h2>

                <div id="eventsList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <!-- Event cards will be dynamically generated -->
                </div>

                <!-- No Results Message -->
                <div id="noResults" class="hidden text-center py-16">
                    <div class="w-24 h-24 mx-auto mb-6 bg-gray-100 rounded-full flex items-center justify-center">
                        <i class="fas fa-calendar-times text-gray-400 text-3xl"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-600 mb-2">Aucun événement trouvé</h3>
                    <p class="text-gray-500">Essayez de modifier vos critères de recherche</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-gray-900 text-white py-16 relative overflow-hidden">
        <div class="absolute inset-0 opacity-5">
            <div class="absolute top-0 left-0 w-full h-full bg-gradient-to-br from-purple-900 to-indigo-900"></div>
        </div>

        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative">
            <div class="grid grid-cols-1 lg:grid-cols-4 gap-12">
                <div class="lg:col-span-2">
                    <div class="flex items-center space-x-4 mb-8">
                        <div class="w-16 h-16 bg-gradient-to-br from-purple-500 to-purple-600 rounded-2xl flex items-center justify-center shadow-xl">
                            <i class="fas fa-mountain text-white text-2xl"></i>
                        </div>
                        <div>
                            <h1 class="font-display font-bold text-3xl">Cévennes Sud</h1>
                            <p class="text-gray-400 text-lg">Votre communauté locale connectée</p>
                        </div>
                    </div>

                    <p class="text-gray-300 text-lg mb-8 leading-relaxed max-w-2xl">
                        Ne manquez aucun moment fort de votre territoire ! Découvrez tous les événements
                        qui animent notre belle région des Cévennes.
                    </p>

                    <div class="flex items-center text-gray-400 text-lg">
                        <i class="fas fa-map-marker-alt mr-3 text-purple-400"></i>
                        <span>Ganges • Saint-Hippolyte-du-Fort • Sud Cévennes</span>
                    </div>
                </div>

                <div>
                    <h3 class="font-semibold mb-8 text-2xl text-white">Navigation</h3>
                    <ul class="space-y-4 text-gray-300 text-lg">
                        <li><a href="index.html" class="hover:text-purple-400 transition-colors flex items-center group">
                            <i class="fas fa-home mr-3 text-purple-400 group-hover:scale-110 transition-transform"></i>
                            Accueil
                        </a></li>
                        <li><a href="acteurs-locaux.html" class="hover:text-blue-400 transition-colors flex items-center group">
                            <i class="fas fa-store mr-3 text-blue-400 group-hover:scale-110 transition-transform"></i>
                            Acteurs Locaux
                        </a></li>
                        <li><a href="echangeons.html" class="hover:text-orange-400 transition-colors flex items-center group">
                            <i class="fas fa-handshake mr-3 text-orange-400 group-hover:scale-110 transition-transform"></i>
                            Échangeons
                        </a></li>
                        <li><a href="parlons-en.html" class="hover:text-emerald-400 transition-colors flex items-center group">
                            <i class="fas fa-comments mr-3 text-emerald-400 group-hover:scale-110 transition-transform"></i>
                            Parlons-en
                        </a></li>
                    </ul>
                </div>

                <div>
                    <h3 class="font-semibold mb-8 text-2xl text-white">Contact</h3>
                    <ul class="space-y-4 text-gray-300 text-lg">
                        <li class="flex items-center">
                            <i class="fas fa-envelope mr-4 text-purple-400"></i>
                            <a href="mailto:contact@cevennesud.fr" class="hover:text-purple-400 transition-colors">
                                contact@cevennesud.fr
                            </a>
                        </li>
                        <li class="flex items-center">
                            <i class="fas fa-phone mr-4 text-purple-400"></i>
                            <a href="tel:0467733000" class="hover:text-purple-400 transition-colors">
                                04 67 73 XX XX
                            </a>
                        </li>
                    </ul>
                </div>
            </div>

            <div class="border-t border-gray-800 mt-16 pt-8 text-center">
                <p class="text-gray-400 text-lg">
                    &copy; 2024 Cévennes Sud. Fait avec ❤️ pour notre belle communauté locale.
                </p>
            </div>
        </div>
    </footer>

    <script>
        // Events data - loaded from JSON file
        let eventsData = [];

        // Load events data from JSON file
        async function loadEventsData() {
            try {
                const response = await fetch('data/events-data.json');
                eventsData = await response.json();
                console.log('Events loaded:', eventsData);
                initializePage();
            } catch (error) {
                console.error('Error loading events:', error);
                eventsData = [];
                initializePage();
            }
        }

        // Call loadEventsData on page load
        loadEventsData();

        // Variables
        let map;
        let markers = [];
        let filteredEvents = [];
        let currentDate = new Date();

        // Removed - initialization now happens after data loads

        // Initialize page after data is loaded
        function initializePage() {
            // Initialize filteredEvents with loaded data
            filteredEvents = [...eventsData];
            console.log('Initializing with', eventsData.length, 'events');

            renderCalendar();
            renderEvents();
            setupEventListeners();
            initScrollAnimations();
            initMap();
        }

        // Initialize map
        function initMap() {
            if (typeof google === 'undefined' || !google.maps) {
                console.log('Google Maps en attente de chargement...');
                setTimeout(initMap, 100);
                return;
            }

            const mapElement = document.getElementById('map');

            // Style Nature - Épuré avec couleurs naturelles (même style que acteurs-locaux)
            const mapStyle = [
                {"featureType":"water","elementType":"geometry","stylers":[{"color":"#a8dce3"},{"lightness":17}]},
                {"featureType":"landscape","elementType":"geometry","stylers":[{"color":"#f5f5f5"},{"lightness":20}]},
                {"featureType":"landscape.natural","elementType":"geometry","stylers":[{"color":"#e8f5e9"}]},
                {"featureType":"road.highway","elementType":"geometry.fill","stylers":[{"color":"#ffffff"},{"lightness":17}]},
                {"featureType":"road.highway","elementType":"geometry.stroke","stylers":[{"color":"#ffffff"},{"lightness":29},{"weight":0.2}]},
                {"featureType":"road.arterial","elementType":"geometry","stylers":[{"color":"#ffffff"},{"lightness":18}]},
                {"featureType":"road.local","elementType":"geometry","stylers":[{"color":"#ffffff"},{"lightness":16}]},
                {"featureType":"poi","elementType":"geometry","stylers":[{"color":"#f5f5f5"},{"lightness":21}]},
                {"featureType":"poi.park","elementType":"geometry","stylers":[{"color":"#c8e6c9"},{"lightness":0}]},
                {"featureType":"poi.park","elementType":"labels.text.fill","stylers":[{"color":"#2e7d32"}]},
                {"elementType":"labels.text.stroke","stylers":[{"visibility":"on"},{"color":"#ffffff"},{"lightness":16}]},
                {"elementType":"labels.text.fill","stylers":[{"saturation":36},{"color":"#333333"},{"lightness":40}]},
                {"elementType":"labels.icon","stylers":[{"visibility":"off"}]},
                {"featureType":"transit","elementType":"geometry","stylers":[{"color":"#f2f2f2"},{"lightness":19}]},
                {"featureType":"administrative","elementType":"geometry.fill","stylers":[{"color":"#fefefe"},{"lightness":20}]},
                {"featureType":"administrative","elementType":"geometry.stroke","stylers":[{"color":"#fefefe"},{"lightness":17},{"weight":1.2}]}
            ];

            map = new google.maps.Map(mapElement, {
                center: { lat: 43.9339, lng: 3.7086 },
                zoom: 13,
                mapTypeControl: true,
                streetViewControl: true,
                fullscreenControl: true,
                styles: mapStyle
            });

            updateMapMarkers();
        }

        // Update map markers
        function updateMapMarkers() {
            if (!map) return;

            markers.forEach(marker => marker.setMap(null));
            markers = [];

            const infoWindow = new google.maps.InfoWindow();

            filteredEvents.forEach(event => {
                const marker = new google.maps.Marker({
                    position: { lat: event.lat, lng: event.lng },
                    map: map,
                    title: event.title
                });

                const contentString = `
                    <div class="p-4 min-w-64">
                        <div class="flex items-center mb-3">
                            <div class="w-10 h-10 bg-gradient-to-br from-purple-400 to-purple-600 rounded-full flex items-center justify-center mr-3">
                                <i class="fas ${getCategoryIcon(event.category)} text-white"></i>
                            </div>
                            <div>
                                <h4 class="font-bold text-lg text-gray-900">${event.title}</h4>
                                <span class="text-xs bg-purple-100 text-purple-800 px-2 py-1 rounded-full">${getCategoryLabel(event.category)}</span>
                            </div>
                        </div>
                        <div class="space-y-2 mb-3">
                            <div class="flex items-center text-sm">
                                <i class="fas fa-calendar-alt w-4 text-purple-500 mr-2"></i>
                                <span class="font-medium">${formatEventDate(event.date, event.time)}</span>
                            </div>
                            <div class="flex items-center text-sm text-gray-600">
                                <i class="fas fa-map-marker-alt w-4 text-purple-500 mr-2"></i>
                                <span>${event.location}</span>
                            </div>
                            <div class="flex items-center text-sm">
                                <i class="fas fa-ticket-alt w-4 text-emerald-500 mr-2"></i>
                                <span class="font-medium text-emerald-600">${event.price}</span>
                            </div>
                        </div>
                        <p class="text-sm text-gray-700 mb-3">${event.description}</p>
                        <div class="text-xs text-gray-500">
                            <i class="fas fa-user mr-1"></i>
                            Organisé par ${event.organizer}
                        </div>
                    </div>
                `;

                marker.addListener('click', () => {
                    infoWindow.setContent(contentString);
                    infoWindow.open(map, marker);
                });

                markers.push(marker);
            });
        }

        // Render events list
        function renderEvents() {
            const container = document.getElementById('eventsList');
            const noResults = document.getElementById('noResults');

            if (filteredEvents.length === 0) {
                container.innerHTML = '';
                noResults.classList.remove('hidden');
                return;
            }

            noResults.classList.add('hidden');

            // Trier par niveau premium : mega-premium -> premium -> standard
            const sortedEvents = [...filteredEvents].sort((a, b) => {
                const levelOrder = { 'mega-premium': 0, 'premium': 1, 'standard': 2 };
                const levelA = levelOrder[a.premium_level || 'standard'];
                const levelB = levelOrder[b.premium_level || 'standard'];
                return levelA - levelB;
            });

            container.innerHTML = sortedEvents.map(event => `
                <div class="event-card rounded-3xl overflow-hidden group">
                    <div class="relative h-48 overflow-hidden">
                        <img src="${event.image}"
                             alt="${event.title}"
                             class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/40 to-transparent"></div>
                        <div class="absolute top-4 right-4">
                            <span class="bg-white/90 backdrop-blur-sm text-gray-800 px-3 py-1 rounded-full text-sm font-medium">
                                ${getCategoryLabel(event.category)}
                            </span>
                        </div>
                        <div class="absolute bottom-4 left-4 text-white">
                            <div class="text-2xl font-bold">${new Date(event.date).getDate()}</div>
                            <div class="text-sm">${getMonthName(new Date(event.date).getMonth())}</div>
                        </div>
                    </div>

                    <div class="p-6">
                        <div class="flex items-start mb-4">
                            <div class="w-12 h-12 bg-gradient-to-br ${getCategoryGradient(event.category)} rounded-xl flex items-center justify-center mr-4 flex-shrink-0">
                                <i class="fas ${getCategoryIcon(event.category)} text-white text-lg"></i>
                            </div>
                            <div class="flex-1">
                                <h3 class="font-display font-bold text-xl text-gray-900 mb-2">${event.title}</h3>
                                <p class="text-gray-600 leading-relaxed">${event.description}</p>
                            </div>
                        </div>

                        <div class="space-y-3 mb-6 text-sm text-gray-500">
                            <div class="flex items-center">
                                <i class="fas fa-clock w-4 mr-3 text-gray-400"></i>
                                <span>${event.time}${event.endTime ? ` - ${event.endTime}` : ''}</span>
                            </div>
                            <div class="flex items-center">
                                <i class="fas fa-map-marker-alt w-4 mr-3 text-gray-400"></i>
                                <span>${event.location}</span>
                            </div>
                            <div class="flex items-center">
                                <i class="fas fa-user w-4 mr-3 text-gray-400"></i>
                                <span>${event.organizer}</span>
                            </div>
                        </div>

                        <div class="flex items-center justify-between mb-6">
                            <div class="text-lg font-bold text-purple-600">${event.price}</div>
                        </div>

                        <div class="flex space-x-3">
                            ${event.phone ? `
                                <a href="tel:${event.phone}"
                                   class="flex-1 bg-purple-100 text-purple-600 px-4 py-2 rounded-xl font-medium text-center hover:bg-purple-200 transition-colors">
                                    <i class="fas fa-phone mr-2"></i>Contacter
                                </a>
                            ` : ''}
                            <button onclick="showOnMap(${event.id})"
                                   class="flex-1 bg-gray-100 text-gray-600 px-4 py-2 rounded-xl font-medium text-center hover:bg-gray-200 transition-colors">
                                <i class="fas fa-map-marker-alt mr-2"></i>Localiser
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Generate calendar
        function renderCalendar() {
            const calendar = document.getElementById('calendar');
            const monthYear = currentDate.toLocaleDateString('fr-FR', { month: 'long', year: 'numeric' });

            // Count events in current month
            const eventsThisMonth = eventsData.filter(event => {
                const eventDate = new Date(event.date);
                return eventDate.getMonth() === currentDate.getMonth() &&
                       eventDate.getFullYear() === currentDate.getFullYear();
            }).length;

            const firstDay = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
            const lastDay = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay() + 1);

            let calendarHTML = `
                <div class="text-center mb-4">
                    <div class="font-bold text-lg capitalize">${monthYear}</div>
                    <div class="text-sm text-gray-500 mt-1">${eventsThisMonth} événement(s) ce mois-ci</div>
                </div>
                <div class="grid grid-cols-7 gap-1 mb-2">
                    <div class="text-center text-xs font-semibold text-gray-500 py-2">Lun</div>
                    <div class="text-center text-xs font-semibold text-gray-500 py-2">Mar</div>
                    <div class="text-center text-xs font-semibold text-gray-500 py-2">Mer</div>
                    <div class="text-center text-xs font-semibold text-gray-500 py-2">Jeu</div>
                    <div class="text-center text-xs font-semibold text-gray-500 py-2">Ven</div>
                    <div class="text-center text-xs font-semibold text-gray-500 py-2">Sam</div>
                    <div class="text-center text-xs font-semibold text-gray-500 py-2">Dim</div>
                </div>
                <div class="grid grid-cols-7 gap-1">
            `;

            const currentDateObj = new Date(startDate);
            for (let i = 0; i < 42; i++) {
                const dateStr = currentDateObj.toISOString().split('T')[0];
                const hasEvents = eventsData.some(event => event.date === dateStr);
                const isCurrentMonth = currentDateObj.getMonth() === currentDate.getMonth();
                const isToday = dateStr === new Date().toISOString().split('T')[0];

                calendarHTML += `
                    <div class="calendar-day text-center py-2 px-1 text-sm cursor-pointer rounded
                        ${!isCurrentMonth ? 'text-gray-300' : 'text-gray-700'}
                        ${hasEvents ? 'has-events' : ''}
                        ${isToday ? 'font-bold text-purple-600' : ''}"
                        data-date="${dateStr}">
                        ${currentDateObj.getDate()}
                    </div>
                `;

                currentDateObj.setDate(currentDateObj.getDate() + 1);
            }

            calendarHTML += '</div>';
            calendar.innerHTML = calendarHTML;

            // Add click events to calendar days
            document.querySelectorAll('.calendar-day').forEach(day => {
                day.addEventListener('click', function() {
                    const date = this.dataset.date;
                    filterEventsByDate(date);

                    // Update selected day
                    document.querySelectorAll('.calendar-day').forEach(d => d.classList.remove('selected'));
                    this.classList.add('selected');
                });
            });
        }

        // Setup event listeners
        function setupEventListeners() {
            // Mobile menu
            document.getElementById('mobile-menu-btn').addEventListener('click', function() {
                const menu = document.getElementById('mobile-menu');
                menu.classList.toggle('hidden');
            });

            // Search
            document.getElementById('searchInput').addEventListener('input', function(e) {
                filterEvents();
            });

            // Category filters
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    filterEvents();
                });
            });

            // Calendar navigation
            document.getElementById('prevMonth').addEventListener('click', function() {
                currentDate.setMonth(currentDate.getMonth() - 1);
                renderCalendar();
            });

            document.getElementById('nextMonth').addEventListener('click', function() {
                currentDate.setMonth(currentDate.getMonth() + 1);
                renderCalendar();
            });

            // Les boutons de création sont maintenant des liens directs (plus besoin d'event listener)
        }

        // Filter events
        function filterEvents() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const activeCategory = document.querySelector('.filter-btn.active').dataset.category;

            filteredEvents = eventsData.filter(event => {
                const matchesSearch = !searchTerm ||
                    event.title.toLowerCase().includes(searchTerm) ||
                    event.description.toLowerCase().includes(searchTerm) ||
                    event.location.toLowerCase().includes(searchTerm) ||
                    event.organizer.toLowerCase().includes(searchTerm);

                const matchesCategory = activeCategory === 'all' || event.category === activeCategory;

                return matchesSearch && matchesCategory;
            });

            renderEvents();
            updateMapMarkers();
        }

        // Filter events by date
        function filterEventsByDate(date) {
            filteredEvents = eventsData.filter(event => event.date === date);
            renderEvents();
            updateMapMarkers();
        }

        // Utility functions
        function getCategoryIcon(category) {
            const icons = {
                festival: 'fa-music',
                marche: 'fa-shopping-basket',
                culture: 'fa-theater-masks',
                sport: 'fa-running',
                atelier: 'fa-tools'
            };
            return icons[category] || 'fa-calendar';
        }

        function getCategoryLabel(category) {
            const labels = {
                festival: 'Festival',
                marche: 'Marché',
                culture: 'Culture',
                sport: 'Sport',
                atelier: 'Atelier'
            };
            return labels[category] || 'Événement';
        }

        function getCategoryGradient(category) {
            const gradients = {
                festival: 'from-amber-400 to-amber-600',
                marche: 'from-emerald-400 to-emerald-600',
                culture: 'from-red-400 to-red-600',
                sport: 'from-cyan-400 to-cyan-600',
                atelier: 'from-purple-400 to-purple-600'
            };
            return gradients[category] || 'from-gray-400 to-gray-600';
        }

        function formatEventDate(date, time) {
            const eventDate = new Date(date);
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            const formattedDate = eventDate.toLocaleDateString('fr-FR', options);
            return time ? `${formattedDate} à ${time}` : formattedDate;
        }

        function getMonthName(monthIndex) {
            const months = ['Jan', 'Fév', 'Mar', 'Avr', 'Mai', 'Juin', 'Juil', 'Aoû', 'Sep', 'Oct', 'Nov', 'Déc'];
            return months[monthIndex];
        }

        // Map functions
        function centerMap() {
            if (filteredEvents.length > 0) {
                const group = new L.featureGroup(markers);
                map.fitBounds(group.getBounds().pad(0.1));
            } else {
                map.setView([43.9339, 3.7086], 13);
            }
        }

        function showOnMap(eventId) {
            const event = eventsData.find(e => e.id === eventId);
            if (event) {
                map.setView([event.lat, event.lng], 16);

                // Find and open the marker popup
                const marker = markers.find(m => m.getLatLng().lat === event.lat && m.getLatLng().lng === event.lng);
                if (marker) {
                    marker.openPopup();
                }
            }
        }

        // Scroll animations
        function initScrollAnimations() {
            function revealOnScroll() {
                const reveals = document.querySelectorAll('.reveal');
                reveals.forEach(element => {
                    const windowHeight = window.innerHeight;
                    const elementTop = element.getBoundingClientRect().top;
                    const elementVisible = 150;

                    if (elementTop < windowHeight - elementVisible) {
                        element.classList.add('active');
                    }
                });
            }

            window.addEventListener('scroll', revealOnScroll);
            revealOnScroll();
        }

        // Navigation background on scroll
        function handleNavScroll() {
            const nav = document.querySelector('nav');
            const scrolled = window.scrollY > 50;

            if (scrolled) {
                nav.style.background = 'rgba(255, 255, 255, 0.98)';
                nav.style.boxShadow = '0 4px 20px rgba(0, 0, 0, 0.1)';
            } else {
                nav.style.background = 'rgba(255, 255, 255, 0.95)';
                nav.style.boxShadow = '0 4px 20px rgba(0, 0, 0, 0.08)';
            }
        }

        window.addEventListener('scroll', handleNavScroll);
        handleNavScroll();
    </script>
</body>
</html>