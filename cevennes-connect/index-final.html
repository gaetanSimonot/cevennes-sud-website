<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sud Cévennes Connect</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Poppins:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">

    <style>
        :root {
            --color-primary: #059669;
            --color-secondary: #ea580c;
            --color-accent: #7c3aed;
            --sidebar-width: 320px;
        }

        body {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            font-feature-settings: 'cv02', 'cv03', 'cv04', 'cv11';
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        }

        .font-display { font-family: 'Poppins', sans-serif; }

        /* Layout principal */
        .main-layout {
            display: grid;
            grid-template-areas:
                "sidebar header header"
                "sidebar map details";
            grid-template-columns: var(--sidebar-width) 1fr 450px;
            grid-template-rows: auto 1fr;
            height: 100vh;
            gap: 0;
        }

        .sidebar { grid-area: sidebar; }
        .header { grid-area: header; }
        .map-area { grid-area: map; }
        .details-panel { grid-area: details; }

        /* Layout mobile */
        @media (max-width: 1024px) {
            .main-layout {
                grid-template-areas:
                    "header header header"
                    "map map map"
                    "sidebar sidebar sidebar";
                grid-template-columns: 1fr;
                grid-template-rows: auto 1fr 300px;
            }
        }

        /* Sidebar des catégories */
        .categories-sidebar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-right: 1px solid rgba(0, 0, 0, 0.1);
            overflow-y: auto;
        }

        .category-item {
            transition: all 0.3s cubic-bezier(0.23, 1, 0.320, 1);
            border-left: 4px solid transparent;
        }

        .category-item:hover {
            background: rgba(5, 150, 105, 0.05);
            border-left-color: var(--color-primary);
            transform: translateX(5px);
        }

        .category-item.active {
            background: rgba(5, 150, 105, 0.1);
            border-left-color: var(--color-primary);
            transform: translateX(8px);
        }

        /* Header adaptatif */
        .adaptive-header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            padding: 1rem 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            transition: all 0.6s cubic-bezier(0.23, 1, 0.320, 1);
        }

        /* Boutons intelligents */
        .smart-btn {
            transition: all 0.6s cubic-bezier(0.23, 1, 0.320, 1);
            position: relative;
            overflow: hidden;
        }

        .smart-btn.active {
            min-width: 300px;
            transform: scale(1.05);
            z-index: 10;
        }

        .smart-btn.inactive {
            min-width: 60px;
            transform: scale(0.8);
            opacity: 0.7;
        }

        .smart-btn.inactive .btn-text,
        .smart-btn.inactive .btn-arrow {
            opacity: 0;
            transform: scale(0);
        }

        .smart-btn:hover:not(.active) {
            transform: scale(0.85);
            opacity: 0.9;
        }

        /* Shine effect */
        .smart-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }

        .smart-btn:hover::before {
            left: 100%;
        }

        /* Panneau de détails */
        .details-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-left: 1px solid rgba(0, 0, 0, 0.1);
            transform: translateX(100%);
            transition: transform 0.5s cubic-bezier(0.23, 1, 0.320, 1);
        }

        .details-panel.open {
            transform: translateX(0);
        }

        /* Cards modernes */
        .modern-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s cubic-bezier(0.23, 1, 0.320, 1);
        }

        .modern-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            border-color: rgba(5, 150, 105, 0.3);
        }

        /* Scrollbar moderne */
        .modern-scroll::-webkit-scrollbar { width: 6px; }
        .modern-scroll::-webkit-scrollbar-track { background: rgba(0,0,0,0.05); border-radius: 10px; }
        .modern-scroll::-webkit-scrollbar-thumb { background: linear-gradient(135deg, #059669, #10b981); border-radius: 10px; }

        /* Gradients */
        .gradient-primary { background: linear-gradient(135deg, #059669 0%, #10b981 50%, #34d399 100%); }
        .gradient-secondary { background: linear-gradient(135deg, #ea580c 0%, #f97316 50%, #fb923c 100%); }
        .gradient-accent { background: linear-gradient(135deg, #7c3aed 0%, #8b5cf6 50%, #a78bfa 100%); }

        /* Animations */
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in { animation: fadeInUp 0.8s ease-out forwards; }
        .stagger-1 { animation-delay: 0.1s; }
        .stagger-2 { animation-delay: 0.2s; }
        .stagger-3 { animation-delay: 0.3s; }

        /* Logo flottant */
        .floating-logo {
            position: absolute;
            top: 1rem;
            left: 1rem;
            z-index: 100;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            padding: 0.5rem 1rem;
            border-radius: 1rem;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }
    </style>
</head>

<body class="overflow-hidden">
    <!-- Logo flottant -->
    <div class="floating-logo">
        <div class="flex items-center gap-2">
            <div class="w-8 h-8 gradient-primary rounded-lg flex items-center justify-center">
                <i class="fas fa-mountain text-white text-sm"></i>
            </div>
            <div>
                <div class="font-display font-bold text-sm text-gray-900">Sud Cévennes</div>
                <div class="text-xs text-gray-600">Connect</div>
            </div>
        </div>
    </div>

    <div class="main-layout">
        <!-- Sidebar des catégories -->
        <aside class="sidebar categories-sidebar">
            <div class="p-6">
                <h2 class="font-display font-bold text-xl text-gray-800 mb-6">
                    <i class="fas fa-filter mr-3 text-green-600"></i>
                    Catégories
                </h2>

                <div id="categories-list" class="space-y-2">
                    <!-- Généré dynamiquement -->
                </div>
            </div>
        </aside>

        <!-- Header avec boutons adaptatifs -->
        <header class="header adaptive-header">
            <button id="btn-nous" class="smart-btn active gradient-primary text-white px-8 py-4 rounded-2xl font-bold shadow-lg flex items-center gap-3">
                <div class="w-10 h-10 bg-white bg-opacity-20 rounded-xl flex items-center justify-center">
                    <i class="fas fa-store text-xl"></i>
                </div>
                <div class="btn-text transition-all duration-300">
                    <div class="font-black text-lg">NOUS</div>
                    <div class="text-green-100 text-sm opacity-90">Acteurs locaux</div>
                </div>
                <i class="fas fa-arrow-right btn-arrow transition-all duration-300"></i>
            </button>

            <button id="btn-echangeons" class="smart-btn inactive gradient-secondary text-white px-8 py-4 rounded-2xl font-bold shadow-lg flex items-center gap-3">
                <div class="w-10 h-10 bg-white bg-opacity-20 rounded-xl flex items-center justify-center">
                    <i class="fas fa-handshake text-xl"></i>
                </div>
                <div class="btn-text transition-all duration-300">
                    <div class="font-black text-lg">ÉCHANGEONS</div>
                    <div class="text-orange-100 text-sm opacity-90">Petites annonces</div>
                </div>
                <i class="fas fa-arrow-right btn-arrow transition-all duration-300"></i>
            </button>

            <button id="btn-moments" class="smart-btn inactive gradient-accent text-white px-8 py-4 rounded-2xl font-bold shadow-lg flex items-center gap-3">
                <div class="w-10 h-10 bg-white bg-opacity-20 rounded-xl flex items-center justify-center">
                    <i class="fas fa-calendar-star text-xl"></i>
                </div>
                <div class="btn-text transition-all duration-300">
                    <div class="font-black text-lg">DE BONS MOMENTS</div>
                    <div class="text-purple-100 text-sm opacity-90">Événements</div>
                </div>
                <i class="fas fa-arrow-right btn-arrow transition-all duration-300"></i>
            </button>
        </header>

        <!-- Zone carte -->
        <main class="map-area relative">
            <div id="map" class="w-full h-full"></div>
        </main>

        <!-- Panneau de détails -->
        <aside class="details-panel modern-scroll">
            <div id="details-header" class="gradient-primary text-white p-6">
                <div class="flex items-center justify-between">
                    <div>
                        <h2 id="details-title" class="font-display font-black text-2xl mb-1">Acteurs locaux</h2>
                        <p id="details-subtitle" class="text-green-100">Commerces et services</p>
                        <p id="details-count" class="text-green-200 text-sm mt-2">
                            <i class="fas fa-map-marker-alt mr-1"></i>
                            <span id="count-number">8</span> dans votre zone
                        </p>
                    </div>
                    <button id="close-details" class="w-10 h-10 bg-white bg-opacity-20 rounded-xl flex items-center justify-center hover:bg-opacity-30 transition-all duration-300">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>

            <div id="details-content" class="flex-1 overflow-y-auto modern-scroll p-4">
                <!-- Contenu généré dynamiquement -->
            </div>
        </aside>
    </div>

    <!-- Scripts -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
        // ==================== DONNÉES D'EXEMPLE ====================
        const mockData = {
            nous: {
                restaurants: [
                    { id: 1, name: "Le Bistrot de Ganges", category: "restaurant", address: "12 Place du Marché, Ganges", phone: "04.67.73.85.42", description: "Cuisine traditionnelle avec produits locaux", lat: 43.9344, lng: 3.6789, rating: 4.5, specialty: "Plats du terroir" },
                    { id: 2, name: "Pizza Luna", category: "restaurant", address: "Avenue de la Liberté, Ganges", phone: "04.67.73.92.15", description: "Pizzeria artisanale, pâte fraîche maison", lat: 43.9354, lng: 3.6799, rating: 4.2, specialty: "Pizzas au feu de bois" },
                    { id: 3, name: "L'Auberge des Cévennes", category: "restaurant", address: "Route de Sumène, Saint-Bauzille", phone: "04.67.82.14.36", description: "Restaurant gastronomique, vue panoramique", lat: 43.9444, lng: 3.6889, rating: 4.8, specialty: "Cuisine gastronomique" }
                ],
                sante: [
                    { id: 4, name: "Cabinet Dr. Martin", category: "sante", address: "8 Rue de la République, Ganges", phone: "04.67.73.41.22", description: "Médecine générale, consultations sur RDV", lat: 43.9324, lng: 3.6769, rating: 4.6, specialty: "Médecine générale" },
                    { id: 5, name: "Pharmacie des Cévennes", category: "sante", address: "Place Jean Jaurès, Ganges", phone: "04.67.73.85.14", description: "Pharmacie, parapharmacie, conseils", lat: 43.9334, lng: 3.6779, rating: 4.4, specialty: "Officine" },
                    { id: 6, name: "Ostéopathe Dubois", category: "sante", address: "15 Avenue du Pont, Saint-Hippolyte", phone: "04.67.81.23.45", description: "Ostéopathie, thérapie manuelle", lat: 43.9644, lng: 3.7089, rating: 4.7, specialty: "Ostéopathie" }
                ],
                artisans: [
                    { id: 7, name: "Menuiserie Cévenole", category: "artisan", address: "Zone Artisanale, Ganges", phone: "04.67.73.67.89", description: "Menuiserie, charpente, agencement", lat: 43.9244, lng: 3.6689, rating: 4.5, specialty: "Menuiserie bois" },
                    { id: 8, name: "Plomberie Moderne", category: "artisan", address: "12 Rue des Artisans, Sumène", phone: "04.67.82.45.67", description: "Plomberie, chauffage, dépannage 24h/24", lat: 43.9544, lng: 3.6989, rating: 4.3, specialty: "Plomberie chauffage" }
                ]
            },
            echangeons: [
                { id: 1, title: "iPhone 14 Pro - État parfait", description: "iPhone 14 Pro 128GB, acheté il y a 6 mois, toujours sous garantie. Vendu avec coque et verre trempé.", price: 850, type: "vente", category: "tech", location: "Ganges", date: "2024-12-20", contact: "Sophie M.", phone: "06.78.45.92.13" },
                { id: 2, title: "Cours de piano à domicile", description: "Professeure diplômée donne cours de piano tous niveaux. Méthode adaptée à chaque élève.", price: 0, priceText: "30€/h", type: "service", category: "loisirs", location: "Saint-Hippolyte-du-Fort", date: "2024-12-19", contact: "Claire D.", phone: "04.67.81.23.45" },
                { id: 3, title: "Légumes bio du potager", description: "Courgettes, tomates cerises, aubergines. Récolte du jour, sans pesticides, agriculture biologique.", price: 0, priceText: "Gratuit", type: "don", category: "alimentaire", location: "Sumène", date: "2024-12-18", contact: "Jean-Pierre L.", phone: "06.45.78.23.91" },
                { id: 4, title: "VTT Décathlon - Bon état", description: "VTT adulte Décathlon, 21 vitesses, freins à disques. Révisé récemment, prêt à rouler.", price: 280, type: "vente", category: "sport", location: "Ganges", date: "2024-12-17", contact: "Marc T.", phone: "07.89.12.45.67" },
                { id: 5, title: "Cherche garde d'enfants", description: "Famille cherche baby-sitter pour garder 2 enfants (8 et 11 ans) occasionnellement le soir.", price: 0, priceText: "À négocier", type: "recherche", category: "services", location: "Saint-Bauzille-de-Putois", date: "2024-12-16", contact: "Amélie R.", phone: "06.23.45.78.91" },
                { id: 6, title: "Échange livres contre livres", description: "Romans contemporains, polars, BD. Plus de 100 ouvrages disponibles pour échange.", price: 0, priceText: "Échange", type: "troc", category: "culture", location: "Cazilhac", date: "2024-12-15", contact: "Bernard V.", phone: "04.67.73.56.78" }
            ],
            moments: [
                { id: 1, title: "Marché hebdomadaire", description: "Grand marché avec producteurs locaux, artisanat, produits du terroir. Tous les vendredis matin.", date: "2024-12-27", time: "8h00-13h00", location: "Place du Marché, Ganges", price: "Gratuit", category: "marche", organizer: "Mairie de Ganges", lat: 43.9344, lng: 3.6789 },
                { id: 2, title: "Concert de Noël", description: "Concert de la chorale des Cévennes. Chants traditionnels et modernes dans l'église romane.", date: "2024-12-24", time: "20h30", location: "Église Saint-Pierre, Ganges", price: "10€", category: "culture", organizer: "Chorale des Cévennes", lat: 43.9354, lng: 3.6779 },
                { id: 3, title: "Randonnée découverte", description: "Randonnée guidée sur les sentiers cathares. Niveau facile, pique-nique inclus.", date: "2024-12-29", time: "9h00-17h00", location: "Parking de la Mairie, Saint-Hippolyte", price: "15€", category: "nature", organizer: "Office du Tourisme", lat: 43.9644, lng: 3.7089 },
                { id: 4, title: "Atelier poterie enfants", description: "Initiation à la poterie pour enfants de 6 à 12 ans. Matériel fourni, goûter inclus.", date: "2025-01-03", time: "14h00-16h00", location: "Salle des associations, Sumène", price: "8€", category: "famille", organizer: "Association Terre et Feu", lat: 43.9544, lng: 3.6989 },
                { id: 5, title: "Match de football", description: "Match de championnat départemental. Buvette et petite restauration sur place.", date: "2024-12-28", time: "15h00", location: "Stade municipal, Ganges", price: "5€", category: "sport", organizer: "FC Ganges", lat: 43.9314, lng: 3.6749 }
            ]
        };

        // ==================== VARIABLES GLOBALES ====================
        let map;
        let currentMode = 'nous';
        let currentCategory = 'all';
        let currentMarkers = [];

        const categoryConfig = {
            nous: {
                all: { label: 'Tout voir', icon: 'fas fa-th-large', color: 'text-gray-700' },
                restaurant: { label: 'Restaurants', icon: 'fas fa-utensils', color: 'text-red-600', desc: 'Bistrot, pizzeria, gastronomie' },
                sante: { label: 'Santé', icon: 'fas fa-user-md', color: 'text-blue-600', desc: 'Médecins, pharmacies, thérapeutes' },
                artisan: { label: 'Artisans', icon: 'fas fa-hammer', color: 'text-amber-600', desc: 'Menuiserie, plomberie, électricité' },
                commerce: { label: 'Commerces', icon: 'fas fa-store', color: 'text-green-600', desc: 'Alimentation, mode, équipement' },
                service: { label: 'Services', icon: 'fas fa-handshake', color: 'text-purple-600', desc: 'Banque, assurance, conseil' }
            },
            echangeons: {
                all: { label: 'Toutes annonces', icon: 'fas fa-list', color: 'text-gray-700' },
                vente: { label: 'Vente', icon: 'fas fa-tag', color: 'text-green-600', desc: 'Objets à vendre' },
                don: { label: 'Don', icon: 'fas fa-gift', color: 'text-blue-600', desc: 'Objets offerts gratuitement' },
                troc: { label: 'Troc', icon: 'fas fa-exchange-alt', color: 'text-purple-600', desc: 'Échanges entre particuliers' },
                recherche: { label: 'Recherche', icon: 'fas fa-search', color: 'text-orange-600', desc: 'Je cherche...' },
                service: { label: 'Services', icon: 'fas fa-handshake', color: 'text-indigo-600', desc: 'Services entre voisins' }
            },
            moments: {
                all: { label: 'Tous événements', icon: 'fas fa-calendar', color: 'text-gray-700' },
                culture: { label: 'Culture', icon: 'fas fa-theater-masks', color: 'text-purple-600', desc: 'Concerts, spectacles, expositions' },
                sport: { label: 'Sport', icon: 'fas fa-running', color: 'text-green-600', desc: 'Matchs, compétitions, cours' },
                nature: { label: 'Nature', icon: 'fas fa-tree', color: 'text-emerald-600', desc: 'Randonnées, sorties nature' },
                famille: { label: 'Famille', icon: 'fas fa-users', color: 'text-pink-600', desc: 'Ateliers enfants, sorties famille' },
                marche: { label: 'Marchés', icon: 'fas fa-shopping-basket', color: 'text-amber-600', desc: 'Marchés, vide-greniers, brocantes' }
            }
        };

        // ==================== INITIALISATION ====================
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 Sud Cévennes Connect Final');

            initMap();
            initEventListeners();
            updateCategories();
            switchMode('nous');
            openDetailsPanel();
        });

        // ==================== CARTE ====================
        function initMap() {
            map = L.map('map', { zoomControl: false }).setView([43.9344, 3.6789], 12);
            L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png').addTo(map);
            L.control.zoom({ position: 'bottomleft' }).addTo(map);
        }

        // ==================== ÉVÉNEMENTS ====================
        function initEventListeners() {
            document.getElementById('btn-nous').addEventListener('click', () => switchMode('nous'));
            document.getElementById('btn-echangeons').addEventListener('click', () => switchMode('echangeons'));
            document.getElementById('btn-moments').addEventListener('click', () => switchMode('moments'));
            document.getElementById('close-details').addEventListener('click', closeDetailsPanel);
        }

        // ==================== GESTION DES MODES ====================
        function switchMode(mode) {
            console.log(`Mode: ${mode}`);
            currentMode = mode;
            currentCategory = 'all';

            updateButtons();
            updateCategories();
            updateContent();
            updateMap();
            openDetailsPanel();
        }

        function updateButtons() {
            document.querySelectorAll('.smart-btn').forEach(btn => {
                const btnMode = btn.id.replace('btn-', '');
                if (btnMode === currentMode) {
                    btn.classList.remove('inactive');
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                    btn.classList.add('inactive');
                }
            });
        }

        function updateCategories() {
            const container = document.getElementById('categories-list');
            const categories = categoryConfig[currentMode];

            container.innerHTML = Object.entries(categories).map(([key, config]) => `
                <div class="category-item p-4 rounded-xl cursor-pointer ${key === currentCategory ? 'active' : ''}" onclick="selectCategory('${key}')">
                    <div class="flex items-center gap-3 mb-2">
                        <div class="w-10 h-10 bg-gray-100 rounded-xl flex items-center justify-center">
                            <i class="${config.icon} ${config.color}"></i>
                        </div>
                        <div class="flex-1">
                            <div class="font-semibold text-gray-800">${config.label}</div>
                            ${config.desc ? `<div class="text-xs text-gray-500 mt-1">${config.desc}</div>` : ''}
                        </div>
                        <div class="w-6 h-6 bg-green-100 rounded-full flex items-center justify-center">
                            <span class="text-xs font-bold text-green-700" id="count-${key}">0</span>
                        </div>
                    </div>
                </div>
            `).join('');

            updateCategoryCounts();
        }

        function selectCategory(category) {
            currentCategory = category;
            updateCategories();
            updateContent();
            updateMap();
        }

        function updateCategoryCounts() {
            const data = getData();
            const categories = categoryConfig[currentMode];

            Object.keys(categories).forEach(key => {
                const count = key === 'all' ? data.length : data.filter(item => item.category === key).length;
                const element = document.getElementById(`count-${key}`);
                if (element) element.textContent = count;
            });
        }

        // ==================== CONTENU ====================
        function updateContent() {
            const config = {
                nous: { title: 'Acteurs locaux', subtitle: 'Commerces et services', gradient: 'gradient-primary' },
                echangeons: { title: 'Petites annonces', subtitle: 'Don, troc, vente', gradient: 'gradient-secondary' },
                moments: { title: 'De bons moments', subtitle: 'Événements et sorties', gradient: 'gradient-accent' }
            };

            const modeConfig = config[currentMode];
            document.getElementById('details-header').className = `${modeConfig.gradient} text-white p-6`;
            document.getElementById('details-title').textContent = modeConfig.title;
            document.getElementById('details-subtitle').textContent = modeConfig.subtitle;

            const data = getFilteredData();
            document.getElementById('count-number').textContent = data.length;

            const container = document.getElementById('details-content');

            if (currentMode === 'nous') {
                updateBusinessContent(container, data);
            } else if (currentMode === 'echangeons') {
                updateListingsContent(container, data);
            } else if (currentMode === 'moments') {
                updateEventsContent(container, data);
            }
        }

        function updateBusinessContent(container, data) {
            container.innerHTML = data.map(business => `
                <div class="modern-card p-4 rounded-xl mb-4 cursor-pointer hover:shadow-lg" onclick="focusOnBusiness(${business.lat}, ${business.lng})">
                    <div class="flex items-start gap-3">
                        <div class="w-12 h-12 bg-gradient-to-br from-green-100 to-green-200 rounded-xl flex items-center justify-center flex-shrink-0">
                            <i class="fas fa-${business.category === 'restaurant' ? 'utensils' : business.category === 'sante' ? 'user-md' : 'hammer'} text-green-600 text-xl"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3 class="font-bold text-lg text-gray-900 mb-1">${business.name}</h3>
                            <p class="text-sm text-gray-600 mb-2">${business.description}</p>
                            <div class="space-y-1 text-sm">
                                <div class="flex items-center gap-2 text-gray-500">
                                    <i class="fas fa-map-marker-alt text-green-500 w-4"></i>
                                    <span class="truncate">${business.address}</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <i class="fas fa-phone text-blue-500 w-4"></i>
                                    <a href="tel:${business.phone}" class="text-blue-600 hover:underline">${business.phone}</a>
                                </div>
                                <div class="flex items-center gap-2">
                                    <i class="fas fa-star text-yellow-500 w-4"></i>
                                    <span class="text-yellow-600 font-medium">${business.rating}/5</span>
                                    <span class="text-gray-500 text-xs">• ${business.specialty}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function updateListingsContent(container, data) {
            container.innerHTML = data.map(listing => `
                <div class="modern-card p-4 rounded-xl mb-4">
                    <div class="flex items-start justify-between mb-3">
                        <h3 class="font-bold text-lg text-gray-900 flex-1">${listing.title}</h3>
                        <div class="text-right ml-4">
                            <div class="font-bold text-xl text-orange-600">${listing.priceText || listing.price + '€'}</div>
                            <span class="text-xs px-2 py-1 rounded-full bg-orange-100 text-orange-800 capitalize">${listing.type}</span>
                        </div>
                    </div>
                    <p class="text-sm text-gray-600 mb-3">${listing.description}</p>
                    <div class="flex items-center justify-between text-sm">
                        <div class="space-y-1 text-gray-500">
                            <div><i class="fas fa-map-marker-alt mr-1"></i>${listing.location}</div>
                            <div><i class="fas fa-user mr-1"></i>${listing.contact}</div>
                            <div><i class="fas fa-clock mr-1"></i>${formatDate(listing.date)}</div>
                        </div>
                        <button class="px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors">
                            <i class="fas fa-phone mr-1"></i>Contacter
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function updateEventsContent(container, data) {
            container.innerHTML = data.map(event => `
                <div class="modern-card p-4 rounded-xl mb-4 cursor-pointer hover:shadow-lg" onclick="focusOnEvent(${event.lat}, ${event.lng})">
                    <div class="flex items-start gap-3">
                        <div class="w-12 h-12 bg-gradient-to-br from-purple-100 to-purple-200 rounded-xl flex items-center justify-center flex-shrink-0">
                            <i class="fas fa-${getCategoryIcon(event.category)} text-purple-600 text-xl"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3 class="font-bold text-lg text-gray-900 mb-1">${event.title}</h3>
                            <p class="text-sm text-gray-600 mb-2">${event.description}</p>
                            <div class="space-y-1 text-sm">
                                <div class="flex items-center gap-2 text-gray-500">
                                    <i class="fas fa-calendar text-purple-500 w-4"></i>
                                    <span>${formatDate(event.date)} • ${event.time}</span>
                                </div>
                                <div class="flex items-center gap-2 text-gray-500">
                                    <i class="fas fa-map-marker-alt text-purple-500 w-4"></i>
                                    <span class="truncate">${event.location}</span>
                                </div>
                                <div class="flex items-center gap-2">
                                    <i class="fas fa-ticket-alt text-purple-500 w-4"></i>
                                    <span class="font-semibold text-purple-600">${event.price}</span>
                                    <span class="text-gray-500 text-xs">• ${event.organizer}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // ==================== CARTE ET MARKERS ====================
        function updateMap() {
            currentMarkers.forEach(marker => map.removeLayer(marker));
            currentMarkers = [];

            const data = getFilteredData();

            data.forEach(item => {
                if (item.lat && item.lng) {
                    const color = currentMode === 'nous' ? '#059669' : currentMode === 'echangeons' ? '#ea580c' : '#7c3aed';
                    const icon = L.divIcon({
                        html: `<div style="background: ${color}; width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; border: 3px solid white; box-shadow: 0 2px 8px rgba(0,0,0,0.3); color: white; font-weight: bold;">
                            ${getItemIcon(item)}
                        </div>`,
                        className: 'custom-marker',
                        iconSize: [30, 30],
                        iconAnchor: [15, 15]
                    });

                    const marker = L.marker([item.lat, item.lng], { icon }).addTo(map);

                    marker.bindPopup(`
                        <div class="p-3 min-w-[250px]">
                            <h3 class="font-bold text-lg mb-2">${item.name || item.title}</h3>
                            <p class="text-sm text-gray-600 mb-2">${item.description}</p>
                            <div class="text-sm">
                                <div><i class="fas fa-map-marker-alt mr-2"></i>${item.address || item.location}</div>
                                ${item.phone ? `<div><i class="fas fa-phone mr-2"></i><a href="tel:${item.phone}">${item.phone}</a></div>` : ''}
                            </div>
                        </div>
                    `);

                    currentMarkers.push(marker);
                }
            });
        }

        // ==================== PANNEAU DE DÉTAILS ====================
        function openDetailsPanel() {
            document.querySelector('.details-panel').classList.add('open');
        }

        function closeDetailsPanel() {
            document.querySelector('.details-panel').classList.remove('open');
        }

        // ==================== UTILITAIRES ====================
        function getData() {
            return currentMode === 'nous' ?
                Object.values(mockData.nous).flat() :
                mockData[currentMode];
        }

        function getFilteredData() {
            const data = getData();
            return currentCategory === 'all' ? data : data.filter(item => item.category === currentCategory);
        }

        function getCategoryIcon(category) {
            const icons = {
                culture: 'theater-masks', sport: 'running', nature: 'tree',
                famille: 'users', marche: 'shopping-basket'
            };
            return icons[category] || 'calendar';
        }

        function getItemIcon(item) {
            if (currentMode === 'nous') {
                return item.category === 'restaurant' ? '🍽️' :
                       item.category === 'sante' ? '🏥' : '🔧';
            } else if (currentMode === 'moments') {
                return '📅';
            }
            return '💬';
        }

        function formatDate(dateString) {
            return new Date(dateString).toLocaleDateString('fr-FR', {
                day: 'numeric', month: 'short'
            });
        }

        function focusOnBusiness(lat, lng) {
            map.setView([lat, lng], 16);
        }

        function focusOnEvent(lat, lng) {
            map.setView([lat, lng], 16);
        }
    </script>
</body>
</html>